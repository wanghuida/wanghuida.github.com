<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[老虎的眼睛]]></title>
  <link href="http://www.wanghd.com/atom.xml" rel="self"/>
  <link href="http://www.wanghd.com/"/>
  <updated>2014-01-26T15:03:47+08:00</updated>
  <id>http://www.wanghd.com/</id>
  <author>
    <name><![CDATA[王惠达 huida wanghuida]]></name>
    <email><![CDATA[wanghuida258@yahoo.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[UITableView (2)]]></title>
    <link href="http://www.wanghd.com/blog/2014/01/26/uitableview-2/"/>
    <updated>2014-01-26T09:30:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2014/01/26/uitableview-2</id>
    <content type="html"><![CDATA[<h3>展示一下最基础的group table应该如何使用（一般设置中最常用），最后有完整的代码</h3>

<p>1 自己先创建一个ViewController, 添加一个UITableView内部属性和数据</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">@interface</span> <span class="nc">AETableViewController</span> <span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">UITableView</span> <span class="o">*</span><span class="n">_table</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">_data</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>2 头里需要实现UITableViewDataSource, UITableViewDelegate</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">@interface</span> <span class="nc">AETableViewController</span> : <span class="nc">UIViewController</span><span class="o">&lt;</span><span class="n">UITableViewDataSource</span><span class="p">,</span> <span class="n">UITableViewDelegate</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>3 往<em>data中加入一点数据,初始化</em>table,设置代理和数据源</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithNibName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibNameOrNil</span> <span class="nf">bundle:</span><span class="p">(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibBundleOrNil</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithNibName:</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="n">nibBundleOrNil</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">group1</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="s">@&quot;关注&quot;</span><span class="p">,</span> <span class="s">@&quot;美美豆&quot;</span><span class="p">,</span> <span class="s">@&quot;安居客&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">group2</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="s">@&quot;wanghd.com&quot;</span><span class="p">,</span> <span class="s">@&quot;惠达&quot;</span><span class="p">,</span> <span class="s">@&quot;达达&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">group3</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="s">@&quot;喜欢&quot;</span><span class="p">,</span> <span class="s">@&quot;关注&quot;</span><span class="p">,</span> <span class="s">@&quot;粉丝&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSMutableArray</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithArray:</span><span class="err">@</span><span class="p">[</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>  <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span><span class="n">bounds</span><span class="p">];</span>
</span><span class='line'>  <span class="n">_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableView</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithFrame:</span><span class="n">rect</span> <span class="nl">style:</span><span class="n">UITableViewStyleGrouped</span><span class="p">];</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_table</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<p>4 设置数据源的总数和内容</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'><span class="cp">#pragma mark datasource</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 每个section head的高度 </span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForHeaderInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 每个section foot高度，设置为0没有效果，0.01才行</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForFooterInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mf">0.01</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// cell的高度</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mf">44.0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 每个section head 的view</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">viewForHeaderInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>  <span class="n">UILabel</span> <span class="o">*</span><span class="n">txt</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILabel</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithFrame:</span><span class="n">rect</span><span class="p">];</span>
</span><span class='line'>  <span class="n">txt</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;group%d&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="n">txt</span><span class="p">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="n">NSTextAlignmentCenter</span><span class="p">;</span>
</span><span class='line'>  <span class="n">txt</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIFont</span> <span class="nl">systemFontOfSize:</span><span class="mi">11</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">txt</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// section 总共有多少个</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">numberOfSectionsInTableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="n">_data</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 每个section 有多少行</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">NSArray</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="n">group</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 具体的cell</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">cellId</span> <span class="o">=</span> <span class="s">@&quot;cell&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">NSArray</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>5 测试最常用的行点击</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'><span class="cp">#pragma mark delegate</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">NSArray</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="n">NSString</span> <span class="o">*</span><span class="n">txt</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>6 看下效果吧</p>

<p><img style="max-width:300px;" src="http://www.wanghd.com/images/post/ios-uitableview-2.jpg" /></p>

<p>7 看下完整的代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">// .h</span>
</span><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">AEGroupTableViewController</span> : <span class="nc">UIViewController</span><span class="o">&lt;</span><span class="n">UITableViewDataSource</span><span class="p">,</span> <span class="n">UITableViewDelegate</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">// .m</span>
</span><span class='line'><span class="cp">#import &quot;AEGroupTableViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">interface</span> <span class="n">AEGroupTableViewController</span> <span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">UITableView</span> <span class="o">*</span><span class="n">_table</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">_data</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">implementation</span> <span class="n">AEGroupTableViewController</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithNibName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="p">(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="n">nibBundleOrNil</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithNibName:</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="n">nibBundleOrNil</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">group1</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="s">@&quot;关注&quot;</span><span class="p">,</span> <span class="s">@&quot;美美豆&quot;</span><span class="p">,</span> <span class="s">@&quot;安居客&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">group2</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="s">@&quot;wanghd.com&quot;</span><span class="p">,</span> <span class="s">@&quot;惠达&quot;</span><span class="p">,</span> <span class="s">@&quot;达达&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">group3</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="s">@&quot;喜欢&quot;</span><span class="p">,</span> <span class="s">@&quot;关注&quot;</span><span class="p">,</span> <span class="s">@&quot;粉丝&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSMutableArray</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithArray:</span><span class="err">@</span><span class="p">[</span><span class="n">group1</span><span class="p">,</span> <span class="n">group2</span><span class="p">,</span> <span class="n">group3</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>  <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span><span class="n">bounds</span><span class="p">];</span>
</span><span class='line'>  <span class="n">rect</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'>  <span class="n">_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableView</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithFrame:</span><span class="n">rect</span> <span class="nl">style:</span><span class="n">UITableViewStyleGrouped</span><span class="p">];</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_table</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'><span class="cp">#pragma mark datasource</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">heightForHeaderInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">heightForFooterInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mf">0.01</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">heightForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="n">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mf">44.0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">viewForHeaderInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>  <span class="n">UILabel</span> <span class="o">*</span><span class="n">txt</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILabel</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithFrame:</span><span class="n">rect</span><span class="p">];</span>
</span><span class='line'>  <span class="n">txt</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;group%d&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="n">txt</span><span class="p">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="n">NSTextAlignmentCenter</span><span class="p">;</span>
</span><span class='line'>  <span class="n">txt</span><span class="p">.</span><span class="n">font</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIFont</span> <span class="nl">systemFontOfSize:</span><span class="mi">11</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">txt</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nl">numberOfSectionsInTableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="n">_data</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">NSArray</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="n">group</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">cellForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="n">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">cellId</span> <span class="o">=</span> <span class="s">@&quot;cell&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">NSArray</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'><span class="cp">#pragma mark delegate</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">didSelectRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="n">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">NSArray</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>  <span class="n">NSString</span> <span class="o">*</span><span class="n">txt</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didReceiveMemoryWarning</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">didReceiveMemoryWarning</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UITableView (1)]]></title>
    <link href="http://www.wanghd.com/blog/2014/01/24/uitableview-1/"/>
    <updated>2014-01-24T17:28:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2014/01/24/uitableview-1</id>
    <content type="html"><![CDATA[<h3>展示一下最基础的uitableview应该如何使用，最后有完整的代码</h3>

<p>1 自己先创建一个ViewController, 添加一个UITableView内部属性和数据</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">@interface</span> <span class="nc">AETableViewController</span> <span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">UITableView</span> <span class="o">*</span><span class="n">_table</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">_data</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>2 头里需要实现UITableViewDataSource, UITableViewDelegate（delegate其实不用，但实际一般都会用到）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">@interface</span> <span class="nc">AETableViewController</span> : <span class="nc">UIViewController</span><span class="o">&lt;</span><span class="n">UITableViewDataSource</span><span class="p">,</span> <span class="n">UITableViewDelegate</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>3 往<em>data中加入一点数据,初始化</em>table,设置代理和数据源</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithNibName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibNameOrNil</span> <span class="nf">bundle:</span><span class="p">(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="nv">nibBundleOrNil</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithNibName:</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="n">nibBundleOrNil</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nl">arrayWithArray:</span><span class="err">@</span><span class="p">[</span><span class="s">@&quot;美美豆&quot;</span><span class="p">,</span> <span class="s">@&quot;抢拍&quot;</span><span class="p">,</span> <span class="s">@&quot;预约&quot;</span><span class="p">,</span> <span class="s">@&quot;wanghd.com&quot;</span><span class="p">,</span> <span class="s">@&quot;王惠达&quot;</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>  <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">];</span>
</span><span class='line'>  <span class="n">_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableView</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithFrame:</span><span class="n">rect</span> <span class="nl">style:</span><span class="n">UITableViewStylePlain</span><span class="p">];</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_table</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<p>4 设置数据源的总数和内容</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'><span class="cp">#pragma mark datasource</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="n">_data</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">cellId</span> <span class="o">=</span> <span class="s">@&quot;cell&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// 这里可以复用cell提高性能</span>
</span><span class='line'>  <span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>5 运行起来看下效果吧</p>

<p><img style="max-width:300px;" src="http://www.wanghd.com/images/post/ios-uitableview-1.jpg" /></p>

<p>6 附赠一份完整的代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">// .h</span>
</span><span class='line'><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">AETableViewController</span> : <span class="nc">UIViewController</span><span class="o">&lt;</span><span class="n">UITableViewDataSource</span><span class="p">,</span> <span class="n">UITableViewDelegate</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="cp">// .m</span>
</span><span class='line'><span class="cp">#import &quot;AETableViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">interface</span> <span class="n">AETableViewController</span> <span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">UITableView</span> <span class="o">*</span><span class="n">_table</span><span class="p">;</span>
</span><span class='line'>  <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">_data</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">implementation</span> <span class="n">AETableViewController</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithNibName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="p">(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="n">nibBundleOrNil</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithNibName:</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="n">nibBundleOrNil</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nl">arrayWithArray:</span><span class="err">@</span><span class="p">[</span><span class="s">@&quot;美美豆&quot;</span><span class="p">,</span> <span class="s">@&quot;抢拍&quot;</span><span class="p">,</span> <span class="s">@&quot;预约&quot;</span><span class="p">,</span> <span class="s">@&quot;wanghd.com&quot;</span><span class="p">,</span> <span class="s">@&quot;王惠达&quot;</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>  <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">];</span>
</span><span class='line'>  <span class="n">_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableView</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithFrame:</span><span class="n">rect</span> <span class="nl">style:</span><span class="n">UITableViewStylePlain</span><span class="p">];</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="n">_table</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_table</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark -</span>
</span><span class='line'><span class="cp">#pragma mark datasource</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="n">section</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">[</span><span class="n">_data</span> <span class="n">count</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nl">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">cellForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="n">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">cellId</span> <span class="o">=</span> <span class="s">@&quot;cell&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">cell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle:</span><span class="n">UITableViewCellStyleDefault</span> <span class="nl">reuseIdentifier:</span><span class="n">cellId</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">_data</span> <span class="nl">objectAtIndex:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didReceiveMemoryWarning</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">didReceiveMemoryWarning</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[纯代码写ios]]></title>
    <link href="http://www.wanghd.com/blog/2014/01/22/chun-dai-ma-xie-ios/"/>
    <updated>2014-01-22T18:30:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2014/01/22/chun-dai-ma-xie-ios</id>
    <content type="html"><![CDATA[<h3>纯代码写ios 后期更容易维护</h3>

<ul>
<li>半年没有写文章，趁过年放假好好补补，用一个简单的纯代码helloworld开始吧</li>
</ul>


<p>1 打开xcode创建一个空项目呗</p>

<p><img style="max-width:500px;" src="http://www.wanghd.com/images/post/ios-new-project.jpg" /></p>

<p>2 查看AppDelegate</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// AppDelegate 就是UIApplicationMain的代理 , 启动时会调用一下方法</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// 初始化一个uiwindow</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
</span><span class='line'>    <span class="c1">// 设置默认背景为白色</span>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</span><span class='line'>    <span class="c1">// 显示到最前端，并获取输入</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="n">makeKeyAndVisible</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<p>3 添加一个自己view controller</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import &quot;AEViewController.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">AEViewController</span> <span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="err">@</span><span class="n">implementation</span> <span class="n">AEViewController</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithNibName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="p">(</span><span class="n">NSBundle</span> <span class="o">*</span><span class="p">)</span><span class="n">nibBundleOrNil</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithNibName:</span><span class="n">nibNameOrNil</span> <span class="nl">bundle:</span><span class="n">nibBundleOrNil</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>  <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">];</span>
</span><span class='line'>  <span class="n">UILabel</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UILabel</span> <span class="n">alloc</span><span class="p">]</span><span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)];</span>
</span><span class='line'>  <span class="n">label</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;Hello World&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">label</span><span class="p">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blackColor</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">label</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didReceiveMemoryWarning</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">super</span> <span class="n">didReceiveMemoryWarning</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>4 设置rootViewController</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="p">[[</span><span class="n">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
</span><span class='line'>  <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="n">makeKeyAndVisible</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">AEViewController</span> <span class="o">*</span><span class="n">viewCtl</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AEViewController</span> <span class="n">alloc</span><span class="p">]</span><span class="n">init</span><span class="p">];</span>
</span><span class='line'>  <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">viewCtl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>5 运行看一下效果</p>

<p><img style="max-width:300px;" src="http://www.wanghd.com/images/post/ios-new-project-ret.jpg" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[304缓存图片没有触发load事件]]></title>
    <link href="http://www.wanghd.com/blog/2013/07/25/304huan-cun-tu-pian-mei-you-hong-fa-loadshi-jian/"/>
    <updated>2013-07-25T14:54:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/07/25/304huan-cun-tu-pian-mei-you-hong-fa-loadshi-jian</id>
    <content type="html"><![CDATA[<ul>
<li>图片墙需要计算图片高度，只有等图片load好计算的高度才正确，所以代码如下：</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.img-div&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//设置load事件</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">).</span><span class="nx">load</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="cm">/* 用height()获取高度，省略事件逻辑 */</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>感觉上面的代码很符合逻辑了，问题出现了：</p></li>
<li><p>当图片返回304缓存时，该图片不能触发load事件。。。（通过判断complete属性来修正）</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.img-div&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="cm">/* 用height()获取高度，省略事件逻辑 */</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//使用one强制事件只触发一次，缓存的图片通过load()方法进行触发</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">complete</span><span class="p">)</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">load</span><span class="p">();</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu keychain 使用]]></title>
    <link href="http://www.wanghd.com/blog/2013/07/18/ubuntu-keychain-shi-yong/"/>
    <updated>2013-07-18T22:33:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/07/18/ubuntu-keychain-shi-yong</id>
    <content type="html"><![CDATA[<ul>
<li>ssh-keygen生成密钥，经常会设置一个密码，让试图窃取的人无计可施。</li>
<li>问题来了，每次登录都会要求输入密码，是时候来搞个keychain了</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo apt-get install keychain
</span><span class='line'><span class="nv">$ </span>/usr/bin/keychain ~/.ssh/id_rsa
</span><span class='line'>
</span><span class='line'><span class="c"># 加到.profile</span>
</span><span class='line'>. ~/.keychain/<span class="nv">$HOSTNAME</span>-sh
</span><span class='line'>. ~/.profile
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>keychain到底干了什么呀？</li>
</ul>


<p>keychain会起一个ssh-agent，后来登录的人通过$HOSTNAME-sh设置环境变量使用同一个ssh-agent</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[linux 操作集锦]]></title>
    <link href="http://www.wanghd.com/blog/2013/07/17/linux-cao-zuo-ji-jin/"/>
    <updated>2013-07-17T19:18:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/07/17/linux-cao-zuo-ji-jin</id>
    <content type="html"><![CDATA[<h2>第一部</h2>

<h3>1. 以Sudo运行上条命令</h3>

<pre><code>$ sudo !!
</code></pre>

<p>通常出现的情况是，敲完命令执行后报错才发现忘了<code>sudo</code>。这时，新手用户就会<code>:</code>按上箭头，按左箭头，盯着光标回到开始处，输入<code>sudo</code>，回车;高手用户就蛋定多了，按<code>Ctrl-p</code>，按<code>Ctrl-a</code>，输入<code>sudo</code>，回车。这里介绍这个是天外飞仙级别的，对，就直接<code>sudo !!</code>。</p>

<p>两个叹号是bash的一个特性，称为事件引用符(event designators)。<code>!!</code>相当于<code>!-1</code>，引用前一条命令，当然也可以<code>!-2</code>，<code>!-50</code>。默认情况下bash会在<code>~/.bash_history</code>文件内记录用户执行的最近500条命令，<code>history</code>命令可以显示这些命令.</p>

<!-- more -->


<h3>2. 以HTTP方式共享当前文件夹的文件</h3>

<pre><code>$ python -m SimpleHTTPServer
</code></pre>

<p>这命令启动了Python的SimpleHTTPServer模块，命令执行后将在本机8000端口开放HTTP服务，在其他能访问本机的机器的浏览器打开http://ip:8000即打开一个目录列表，点击即可下载。</p>

<p>额外的:用 python 快速开启一个<code>SMTP</code>服务</p>

<pre><code>$ python -m smtpd -n -c DebuggingServer localhost:1025
</code></pre>

<p>这是一个用Python标准库smtpd(用<code>-m smtpd</code>指定)实现在简易SMTP服务，运行于1025端口 。另外三个参数的解释:</p>

<pre><code>-n    参数让Python不要进行setuid(改变用户)为"nobody"，也就是说直接用你的帐号来运行
-c DebuggingServer    让Python运行时在屏幕上输出调试及运行信息
localhost:1025        让Python在本地的1025端口上开启SMTP服务
</code></pre>

<p>另外，假如想让程序运行于标准的25的端口上的话，必须使用<code>sudo</code>命令，因为只有root才能在1-1024端口上开启服务。如下:</p>

<pre><code>sudo python -m smtpd -n -c DebuggingServer localhost:25
</code></pre>

<h3>3. 在以普通用户打开的VIM当中保存一个ROOT用户文件</h3>

<pre><code>:w !sudo tee %
</code></pre>

<p>常常忘记了<code>sudo</code>就直接用vim编辑/etc内的文件，等编辑好了，保存时候才发现没权限。查阅vim的文档(输入<code>:help :w</code>)，会提到命令<code>:w!{cmd}</code>，让vim执行一个外部命令{cmd}，然后把当前缓冲区的内容从stdin传入。tee是一个把stdin保存到文件的小工具。而%，是vim当中一个只读寄存器的名字，总保存着当前编辑文件的文件路径。所以执行这个命令，就相当于从vim外部修改了当前编辑的文件。</p>

<h3>4. 切换回上一个目录</h3>

<pre><code>$ cd -
</code></pre>

<p>横杆-代表上一个目录的路径。实际上<code>cd -</code>就是<code>cd $OLDPWD</code>的简写，bash的固定变量<code>$OLDPWD</code>总保存着之前一个目录的路径。相对地，<code>$PWD</code>总保存着当前目录的路径。这些变量在编写shell脚本时候相当有用。</p>

<h3>5. 替换上一条命令中的一个短语</h3>

<pre><code>$ ^foo^bar^
</code></pre>

<p>　　
又是另外一个事件引用符，可以把上一条命令当中的foo替换成bar。在需要重复运行调试一道长长的命令，需要测试某个参数时候，用这个命令会比较实用。这道命令的原始样式应该是这样的:</p>

<pre><code>!!:s/foo/bar/
</code></pre>

<p>本文一开始介绍过<code>!!</code>，vim、sed的替换操作都是这样的语法。</p>

<h3>6. 快速备份一个文件</h3>

<pre><code>$ cp filename{，.bak}
</code></pre>

<p>这道命令把filename文件拷贝成filename.bak，在一些比较复杂的安装教程里面可以见到这样的用法。其原理就在于bash对大括号的展开操作，<code>filename{，.bak}</code>这一段会被展开成<code>filename filename.bak</code>再传给cp，于是就有了备份的命令了。大括号在bash里面是一个排列的意义，<code>$ echo {a，b，c}{a，b，c}{a，b，c}</code>将输出三个集合的全排列</p>

<h3>7. 免密码SSH登录主机</h3>

<pre><code>$ ssh-copy-id remote-machine
</code></pre>

<p>这个命令把当前用户的公钥串写入到远程主机的<code>~/.ssh/authorized_keys</code>内，这样下次使用ssh登录的时候，远程主机就直接根据这串密钥完成身份校验，不再询问密码。前提是你当前用户已经生成了公钥，因为默认是没有的，先执行<code>ssh-keygen</code>试试吧!</p>

<p>这个命令如果用手工完成，是这样的:</p>

<pre><code>your-machine$ scp ~/.ssh/identity.pub remote-machine:
your-machine$ ssh remote-machine
remote-machine$ cat identity.pub &gt;&gt; ~/.ssh/authorized_keys
</code></pre>

<p>如果你想删掉远程主机上的密钥，直接打开authorized_keys，搜索你的用户名，删除那行即可。</p>

<h3>8. 抓取LINUX桌面的视频</h3>

<pre><code>$ ffmpeg -f x11grab -s wxga -r 25 -i :0.0 -sameq /tmp/out.mpg
</code></pre>

<p>我们在一些视频网站上看到别人的3D桌面怎么怎么酷的视频，通常就是这么来的，ffmpeg可以直接解码X11的图形，并转换到相应输出格式。ffmpeg的通常用法是，根据一堆参数，输出一个文件，输出文件通常放最后，下面解析下几个参数:</p>

<pre><code>-f x11grab  指定输入类型。因为x11的缓冲区不是普通的视频文件可以侦测格式，必须指定后ffmpeg才知道如何获得输入
-s wxga 设置抓取区域的大小。wxga是`1366*768`的标准说法，也可以换成`-s 800×600`的写法
-r 25   设置帧率，即每秒抓取的画面数
-i :0.0 设置输入源，本地X默认在0.0
-sameq   保持跟输入流一样的图像质量，以用来后期处理
</code></pre>

<h2>第二部分</h2>

<h3>1. 用你最喜欢的编辑器来敲命令</h3>

<pre><code>command &lt;CTRL-x CTRL-e&gt;
</code></pre>

<p>在已经敲完的命令后按<code>&lt;CTRL-x CTRL-e&gt;</code>，会打开一个指定的编辑器(比如vim，通过环境变量<code>$EDITOR</code>指定)，里面就是你刚输入的命令，然后进行编辑，特别是对那些参数异常复杂的程序，比如<code>mencoder/ffmpeg</code>，一个命令动辄3、4行的。</p>

<p>实际上这是readline库的功能，在默认情况下，bash使用的是emacs模式的命令行操作方式， <code>&lt;CTRL-x CTRL-e&gt;</code>是调用这个功能的一个绑定。如果你习惯使用vi模式，按<code>&lt;ESC v&gt;</code>可以实现同样功能。如果喜欢别的编辑器，可以在<code>~/.bashrc</code>里面放上比如<code>export EDITOR=nano</code>的命令。</p>

<p>另外一个修改命令的方法是使用<code>fc</code>命令(Fix Command)，在编辑器里面打开上一句命令。我们的第一辑连载提过一个<code>^foo^bar^</code>命令可以用fc来实现:<code>fc -s foo=bar</code>。</p>

<h3>2. 清空或创建一个文件</h3>

<pre><code>&gt; file.txt
</code></pre>

<p><code>&gt;</code>在shell里面是标准输出重定向符，即把命令行输出转往一个文件内，但这里没有”前部命令”，输出为空，于是就覆盖(或创建)成一个空文件了。有些脚本的写法是<code>:&gt;file.txt</code>，因为<code>:</code>是bash默认存在的空函数。单纯创建文件也可以用<code>$touch file.txt</code>，touch本来是用作修改文件的时间戳，但如果文件不存在，就自动创建了。</p>

<h3>3. 用SSH创建端口转发通道</h3>

<pre><code>ssh -N -L2001:remotehost:80 user@somemachine
</code></pre>

<p>这个命令在本机打开了2001端口，对本机2001端口的请求通过somemachine作为跳板，转到remotehost的80端口上。实现效果跟术语反向代理是相似的，实际上就是端口转发，注意上面的描述涉及了3台主机，但当然somemachine可以变成localhost。这个命令比较抽象，但有时候是很有用的，比如因为众所周知的原因国内的IP的80端口无法使用，又或者公司的防火墙只给外网开了ssh端口，需要访问内部服务器一个web应用，以及需要访问某些限定了来源IP的服务，就可以用上这个方法了。举一个具体例子，运行:</p>

<pre><code>ssh -f -N -L 0.0.0.0:443:twitter.com:443 shell.cjb.net
ssh -f -N -L 0.0.0.0:80:twitter.com:80 shell.cjb.net
</code></pre>

<p>然后在<code>/etc/hosts</code>里面添加<code>127.0.0.1 twitter.com</code>，剩下的你懂的。</p>

<h3>4. 重置终端</h3>

<pre><code>reset
</code></pre>

<p>如果你不小心<code>cat</code>了某个二进制文件，很可能整个终端就傻掉了，可能不会换行，没法回显，大堆乱码之类的，这时候敲入<code>reset</code>回车，不管命令有没有显示，就能回复正常了。实际上<code>reset</code>命令只是输出了一些特殊字符，BusyBox里面最简单的reset程序的实现:</p>

<pre><code>printf(“\033c\033(K\033[J\033[0m\033[?25h”);
</code></pre>

<p>输出的这些字符对Shell是有特殊意义的:</p>

<pre><code>\033c   ESC c   发送重置命令
\033(K  ESC ( K 重载终端的字符映射
\033[J  ESC [ J 清空终端内容
\033[0m ESC [ 0 m   初始化字符显示属性
\033[?25h:  ESC [ ? 25 h    让光标可见
</code></pre>

<p>其中字符显示属性经常用来设定打印字符的颜色等</p>

<h3>5. 在午夜的时候执行某命令</h3>

<pre><code>echo cmd | at midnight
</code></pre>

<p>说的就是<code>at</code>这个组件，通常跟<code>cron</code>相提并论，不过<code>at</code>主要用于定时一次性任务，而<code>cron</code>定时周期性任务。<code>at</code>的参数比较人性化，跟英语语法一样，可以<code>tomorrow</code>，<code>next week</code>之类的。</p>

<h3>6. 远程传送麦克风语音（实现一个喊话器）</h3>

<pre><code>dd if=/dev/dsp | ssh username@host dd of=/dev/dsp
</code></pre>

<p><code>/dev/dsp</code>是Linux下声卡的文件映射(Digital Signal Proccessor)，从其中读数据就是录音，往里面写数据就是播放，相当简单!dd是常用的数据拷贝程序，如果不同时指定<code>if</code>、<code>of</code>，就直接使用<code>stdin/stdout</code>来传输。如果没有远程主机，可以试试这样:</p>

<pre><code>dd if=/dev/dsp of=/dev/dsp
</code></pre>

<p>直接回放麦克风的声音，只是有一点延时。但是如果有别的程序正在使用声卡，这个方法就不凑效了，因为一般的声卡都不允许多个音频流同时处理，可以借用alsa组件的工具，arecord跟aplay:</p>

<pre><code>arecord | ssh username@host aplay
</code></pre>

<p>本地回放:</p>

<pre><code>arecord | aplay
</code></pre>

<p>如果你想吓吓别人:</p>

<pre><code>cat /dev/urandom | ssh username@host aplay
</code></pre>

<h3>7. 映射一个内存目录</h3>

<pre><code>mount -t tmpfs -o size=1024m tmpfs /mnt/ram
</code></pre>

<p>这个命令开了一块1G内存来当目录用。不过放心，如果里面没文件，是不会占用内存的，用多少占多少。一般来说没必要手动挂载，因为多数发行版都会在fstab内预留了一个内存目录，挂载在<code>/dev/shm</code>，直接使用即可;最常见的用途是用内存空间来放Firefox的配置，可以让慢吞吞的FF快很多。</p>

<h3>8. 用DIFF对比远程文件跟本地文件</h3>

<pre><code>ssh user@host cat /path/to/remotefile | diff /path/to/localfile -
</code></pre>

<p><code>diff</code>通常的用法是从参数读入两个文件，而命令里面的-则是指从stdin读入了。善用ssh可以让web开发减少很多繁琐，还有比如sshfs，可以从编辑-上传-编辑-上传的人工循环里面解脱出来。</p>

<h3>9. 查看系统中占用端口的进程</h3>

<pre><code>netstat -tulnp
</code></pre>

<p>Netstat是很常用的用来查看Linux网络系统的工具之一，这个参数可以背下来:</p>

<pre><code>-t  显示TCP链接信息
-u  显示UDP链接信息
-l  显示监听状态的端口
-n  直接显示ip，不做名称转换
-p  显示相应的进程PID以及名称(要root权限)
</code></pre>

<p>如果要查看关于sockets更详细占用信息等，可以使用lsof工具。</p>

<h2>第三部分</h2>

<h3>1. 更友好的显示当前挂载的文件系统</h3>

<pre><code>mount | column -t
</code></pre>

<p>这条命令适用于任何文件系统，<code>column</code>用于把输出结果进行列表格式化操作，这里最主要的目的是熟悉<code>columnt</code>的用法。另外可加上列名称来改善输出结果：</p>

<pre><code>(echo "DEVICE - PATH - TYPE FLAGS" &amp;&amp; mount) | column -t
</code></pre>

<p>列2和列4并不是很友好，可以用awk来再处理一下:</p>

<pre><code>(echo "DEVICE PATH TYPE FLAGS" &amp;&amp; mount|awk '$2=$4="";1')|column -t
</code></pre>

<p>最后可以设置一个别名，为nicemount</p>

<pre><code>nicemount(){
　　(echo "DEVICE PATH TYPE FLAGS" &amp;&amp; mount|awk '$2=$4="";1')|column -t; 
}
</code></pre>

<p>直接输入nicemount运行即可。</p>

<h3>2. 运行前一个Shell命令，同时用&#8221;bar&#8221;替换掉命令行中的每一个&#8221;foo&#8221;</h3>

<pre><code>!!:gs/foo/bar
</code></pre>

<p><code>!!</code>表示重复执行上一条命令，并用<code>:gs/foo/bar</code>进行替换操作。</p>

<h3>3. 实时某个目录下查看最新改动过的文件</h3>

<pre><code>watch -d -n 1 'df; ls -FlAt /path'
</code></pre>

<p>在使用这条命令时你需要替换其中的/path部分，<code>watch</code>是实时监控工具，<code>-d</code>参数会高亮显示变化的区域，<code>-n 1</code>参数表示刷新间隔为1秒。<code>df; ls -FlAt /path</code>运行了两条命令，<code>df</code>是输出磁盘使用情况，<code>ls -FlAt</code>则列出/path下面的所有文件。<code>ls -FlAt</code>的参数详解:</p>

<pre><code>-F  在文件后面加一个文件符号表示文件类型，共有 */=&gt;@| 这几种类型，* 表示可执行文件，/ 表示目录，= 表示接口( sockets) ，&gt; 表示门， @ 表示符号链接， | 表示管道
-l  以列表方式显示
-A  显示 . 和 ..
-t  根据时间排序文件
</code></pre>

<h3>4. 通过SSH挂载远程主机上的文件夹</h3>

<pre><code>sshfs name@server:/path/to/folder /path/to/mount/point
</code></pre>

<p>这条命令可以让你通过 SSH 加载远程主机上的文件系统为本地磁盘，前提是你需要安装FUSE及sshfs这两个软件。卸载的话使用<code>fusermount</code>命令:</p>

<pre><code>fusermount -u /path/to/mount/point
</code></pre>

<h3>5. 用 Wget 的递归方式下载整个网站</h3>

<pre><code>wget --random-wait -r -p -e robots=off -U Mozilla www.example.com

- -random-wait  等待0.5到1.5秒的时间来进行下一次请求
-r  开启递归检索
-e robots=off   忽略robots.txt
-U Mozilla  设置 User-Agent 头为 Mozilla
</code></pre>

<h3>6. 执行一条命令但不保存到 history 中</h3>

<pre><code>&lt;space&gt; command
</code></pre>

<p>这条命令可运行于最新的Bash shell里，在其它shell中没测试过。通过在命令行前面添加一个空格，就可以阻止这条命令被保存到<code>~/.bash_history</code>文件中，这个行为可以通过<code>$HISTIGNORE</code>shell变量来控制。设置为<code>HISTIGNORE="&amp;:[ ]*"</code>，表示不保存重复的命令到<code>history</code>中，并且不保存以空格开头的命令行。<code>$HISTIGNOR</code>中的值以冒号分隔。</p>

<h3>7. 显示当前目录中所有子目录的大小</h3>

<pre><code>du -h --max-depth=1
</code></pre>

<p><code>--max-depth=1</code>参数可以让du命令显示当前目录下1级子目录的统计信息，当然你也可以把1改为2，进一步显示2级子目录的统计信息，可以灵活运用。而<code>-h</code>参数则是以Mb 、G这样的单位来显示大小。小工具ncdu可以更方便的达到此效果。</p>

<h3>8. 显示消耗内存最多的10个运行中的进程，以内存使用量排序</h3>

<pre><code>ps aux | sort -nk +4 | tail
</code></pre>

<p>这是一个典型的管道应用，通过<code>ps aux</code>来输出到<code>sort</code>命令，并用<code>sort</code>排序列出4栏，再进一步转到<code>tail</code>命令，最终输出10行显示使用内存最多的进程情况。假如想要发现哪个进程使用了大量内存的话，通常会使用<code>hto</code>p或<code>top</code>而非<code>ps</code>。</p>

<h2>第四部分</h2>

<h3>1. 查看ASCII码表</h3>

<pre><code>man 7 ascii
</code></pre>

<p>上述命令就能很详细的方式解释ascii编码，当然这里还有在线版。man命令的第二个参数是区域码，用来区分索引词的范围，比如printf， C标准库里面的printf跟bash当中的printf是不同的，前者的查询是<code>man 3 printf</code>，后者是<code>man 1 printf</code>。如果这个区域码省略，就会从1开始搜索，直到找到为止。命令<code>man man</code>可以看到详细的解释。</p>

<p>manpages里面还有一些有趣而且实用的资料，可能鲜为人知:</p>

<pre><code>man 1 intro 一篇对从未接触过Linux的用户的简明教程
man 2 syscalls  内核系统请求的列表，按内核版本注释分类，系统编程必备
man 2 select_tut    关于select()系统请求的教程
man 3 string    在头文件内的所有函数
man 3 stdio 关于头文件的使用，标准输入/输出库的说明
man 4 console_codes Linux的终端控制码及其使用解释
man 4 full  介绍/dev/full这个总是处于"满"状态的磁盘。(对应/dev/null这个总是空的设备)
man 5 proc  介绍/proc下的文件系统
man 5 filesystems   各种Linux文件系统
man 7 bootparam 详细解释内核启动参数
man 7 charsets  解释各种语言的编码集。(gbk，gb2312等)
man 7 glob  解释glob文件名管理机制的工作过程
man 7 hier  解释Linux文件系统结构各个部分的作用
man 7 operator  C语言的运算符的列表
man 7 regex 介绍正则表达式
</code></pre>

<h3>2. 简易计时器</h3>

<pre><code>time read
</code></pre>

<p>运行命令开始算起，到结束时按一Enter，就显示出整个过程的时间，精确到ms级别。time是用来计算一个进程在运行到结束过程耗费多少时间的程序，它的输出通常有三项:</p>

<pre><code>$ time ls /opt
...
real 0m0.008s
user 0m0.003s
sys 0m0.007s

real    指整个程序对真实世界而言运行所需时间
user    指程序在用户空间运行的时间，
sys     指程序对系统调用锁占用时间
</code></pre>

<p><code>read</code>本来是一个读取用户输入的命令，常见用法是<code>read LINE</code>，用户输入并回车后，键入的内容就被保存到<code>$LINE</code>变量内，但在键入回车前，这个命令是一直阻塞的。可见<code>time read</code>这命令灵活地利用了操作系统的阻塞。</p>

<h3>3. 在一个子SHELL中运行一个命令</h3>

<pre><code>(cd /tmp &amp;&amp; ls)
</code></pre>

<p>当然这只是演示，要查看目录当然可以<code>ls /tmp</code>。好处就是不会改变当前shell的目录，以及如果命令中设计环境变量，也不会对当前shell有任何修改。</p>

<p>在Shell编程中还有很多使用上引号来括住一个命令:<code>ls /tmp</code>，这也是子shell过程。可是上引号的方法无法嵌套，而使用小括号的方法可以，一个比较纠结的例子是:</p>

<pre><code>echo $(echo -e file:///C|/x%24%28printf "%x" 65))
</code></pre>

<h3>4. 利用中间管道嵌套使用SSH</h3>

<pre><code>ssh -t host_A ssh host_B
</code></pre>

<p>如果目标机器host_B处于比较复杂的网络环境，本机无法直接访问，但另外一台host_A能够访问到host_B，而且也能被本机访问到，那上述命令就解决了方便登录host_B的问题。但理论上这个过程是可以无限嵌套的，比如:</p>

<pre><code>ssh -t host1 ssh -t host2 ssh -t host3 ssh -t host4 ...
</code></pre>

<h3>5. 清空屏幕</h3>

<pre><code>&lt;CTRL+l&gt;
</code></pre>

<p>这个跟之前介绍的<code>reset</code>命令重置终端的作用有些类似，其实都只是发送一段控制序列，让终端的显示复位。还可以这样运行:</p>

<pre><code>tput clear
</code></pre>

<p><code>tput</code>是专门用来控制终端的一个小工具，也挺强大的，详细信息运行<code>man tput</code>查看。</p>

<h3>6. 我想知道一台服务器什么时候重启完</h3>

<pre><code>ping -a IP
</code></pre>

<p><code>ping</code>命令有个audible ping参数<code>-a</code>，当ping通服务器时会让小喇叭叫起来。</p>

<h3>7. 列出你最常用的10条命令</h3>

<pre><code>history | awk '{a[$2]++}END{for(i in a){print a[i] " " i}}' | sort -rn | head
</code></pre>

<p>这行命令组合得很妙: <code>history</code>输出用户了命令历史;<code>awk</code>统计并输出列表;<code>sort</code>排序;<code>head</code>截出前10行。</p>

<h3>8. 用TELNET看《星球大战》</h3>

<pre><code>telnet towel.blinkenlights.nl
</code></pre>

<p>没什么好解释的，就是ASCII艺术之一。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[创业公司的运维工作]]></title>
    <link href="http://www.wanghd.com/blog/2013/07/17/chuang-ye-gong-si-de-yun-wei-gong-zuo/"/>
    <updated>2013-07-17T13:04:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/07/17/chuang-ye-gong-si-de-yun-wei-gong-zuo</id>
    <content type="html"><![CDATA[<h3>创业公司的运维工作应该尽可能简单，不用追求全自动化，但必要的工作还是要做的。</h3>

<br />


<h3>安全管理</h3>

<ol>
<li>有权限的员工登录服务器需要使用<em>key</em>通过跳板机，再进入线上服务器</li>
<li>外部的请求，需要通过<em>lb</em>转发才能访问，内部服务器无法直接提供服务</li>
<li>内部的服务器访问外网需要通过proxy</li>
<li>内部服务器保存操作记录</li>
<li>加强ddos防护</li>
<li>端口和ip的限制</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>                                                                                            
</span><span class='line'>       +------+  +---------+        +-----+                                                 
</span><span class='line'>       |  lb  |  |  proxy  |        | ssh |                                                 
</span><span class='line'>       +------+  +---------+        +-----+                                                 
</span><span class='line'>          |           ^                |                                                    
</span><span class='line'>          v           |                |                                                   
</span><span class='line'>      +--------------------------------|---+                                               
</span><span class='line'>      |                                |   |                                                
</span><span class='line'>      |         internal server     &lt;--+   |                                                
</span><span class='line'>      |                                    |                                                
</span><span class='line'>      +------------------------------------+                                               
</span><span class='line'>                                                                                            </span></code></pre></td></tr></table></div></figure>


<!-- more -->


<h3>服务器 (ubuntu)</h3>

<ol>
<li>服务器上架下架，硬件故障（其实创业公司托管还不如用云服务）</li>
<li>常用软件安装，更新，配置</li>
</ol>


<h3>数据库管理 (mysql)</h3>

<ol>
<li>日志管理：2进制日志，错误日志，慢请求日志</li>
<li>优化性能：读写分离，优化慢查询</li>
<li>冷备，热备</li>
<li>安全：限制访问ip, 权限最小化</li>
</ol>


<h3>监控报警 (cacti nagios)</h3>

<ol>
<li>指定报警处理人</li>
<li>添加报警，添加监控</li>
<li>监控和报警本身状态的维护</li>
</ol>


<h3>图片服务 (mogilefs squid php memcache mysql)</h3>

<ol>
<li>图片备份，必须存储2份以上</li>
<li>图片服务优化</li>
<li>图片服务日志分析，统计数据</li>
</ol>


<h3>信息更新</h3>

<ol>
<li>记录每台服务器上处理的job</li>
<li>记录每台服务器上提供的服务</li>
<li>其他重要信息</li>
</ol>


<h3>其他数据备份</h3>

<ol>
<li>svn,git备份</li>
<li>crontab 备份（有过-r直接删除的经验。。。）</li>
<li>一些重要配置的备份</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CutyCapt html页面生成图片 分享微博]]></title>
    <link href="http://www.wanghd.com/blog/2013/07/15/cutycapt-htmlye-mian-sheng-cheng-tu-pian-fen-xiang-wei-bo/"/>
    <updated>2013-07-15T16:47:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/07/15/cutycapt-htmlye-mian-sheng-cheng-tu-pian-fen-xiang-wei-bo</id>
    <content type="html"><![CDATA[<ul>
<li><p>CutyCapt一个用Qt Webkit把html页面生成图片的工具</p></li>
<li><p>Mac下安装使用</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install cuty_capt
</span><span class='line'>
</span><span class='line'>CutyCapt --private-browsing=off --min-width=640 --min-height=440 \
</span><span class='line'>    --url="http://meimeidou.cn/diySubject/detail/key/1366957139/magnify/1" --out="/tmp/img.png"</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Ubuntu生产环境下安装使用</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># xvfb是一个虚拟的X windows
</span><span class='line'>sudo apt-get install xvfb
</span><span class='line'>sudo apt-get install cutycapt
</span><span class='line'>
</span><span class='line'># 搞一个中文字体，雅黑就不错，可以自己找也可以联系我
</span><span class='line'>scp msyh.ttf idc01-002:/tmp
</span><span class='line'>sudo cp /tmp/msyh.ttf /usr/share/fonts/truetype/
</span><span class='line'>
</span><span class='line'># 如果缺少icu48可以装下
</span><span class='line'>sudo apt-get install libicu48
</span><span class='line'>
</span><span class='line'># 生成图片
</span><span class='line'>xvfb-run --server-args="-screen 0, 1024x768x24" cutycapt --private-browsing=off --min-width=640 --min-height=440 \
</span><span class='line'>    --url="http://meimeidou.cn/diySubject/detail/key/1366957139/magnify/1" --out="/tmp/img.png"
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[php图片处理ubuntu配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/07/02/phptu-pian-chu-li-ubuntupei-zhi/"/>
    <updated>2013-07-02T10:08:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/07/02/phptu-pian-chu-li-ubuntupei-zhi</id>
    <content type="html"><![CDATA[<ul>
<li>安装imagemagick 和图片库</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install libpng12-0 libpng12-dev libpng3
</span><span class='line'>sudo apt-get install libtiff4 libtiff4-dev libtiffxx0c2
</span><span class='line'>sudo apt-get install libjasper-dev libjpeg-dev
</span><span class='line'>sudo apt-get install imagemagick
</span><span class='line'>
</span><span class='line'># 显示 imagemagick 支持的图片类型 
</span><span class='line'>convert -list format
</span><span class='line'>convert -list configure</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>安装 php和php模块</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install php5 php5-curl php5-gd php5-mysql php5-fpm php5-imagick php5-xcache php5-cli php5-common php5-mcrypt</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置xcache</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xcache.size  =  64M
</span><span class='line'>xcache.count =  8
</span><span class='line'>xcache.slots =  16K</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置fpm里的php.ini</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>error_log = /tmp/php-error.log
</span><span class='line'>post_max_size = 20M
</span><span class='line'>upload_max_filesize = 20M
</span><span class='line'>date.timezone = PRC</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置fpm</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user = ***
</span><span class='line'>group = ***
</span><span class='line'>listen = 127.0.0.1:10001
</span><span class='line'>pm.max_children = 16</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装配置nginx请参考<a href="http://www.wanghd.com/blog/2013/03/31/nginx-pei-zhi-mo-ban/">这篇文章</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[浮动居中]]></title>
    <link href="http://www.wanghd.com/blog/2013/06/27/fu-dong-ju-zhong/"/>
    <updated>2013-06-27T10:52:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/06/27/fu-dong-ju-zhong</id>
    <content type="html"><![CDATA[<ul>
<li><p>对于定宽的非浮动元素我们可以用 margin:0 auto; 进行水平居中，对于不定宽的浮动元素我们也有一个常用的技巧解决它的水平居中问题。分解如下：</p></li>
<li><p>HTML 部分：</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="test"&gt;
</span><span class='line'>    &lt;p&gt;浮动的&lt;/p&gt;
</span><span class='line'>    &lt;p&gt;居中的&lt;/p&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>CSS 部分：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.test{
</span><span class='line'>    float:left;
</span><span class='line'>    position:relative;
</span><span class='line'>    left:50%;
</span><span class='line'>}
</span><span class='line'>p{
</span><span class='line'>    float:left;
</span><span class='line'>    position:relative;
</span><span class='line'>    right:50%;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<ul>
<li>这样看来就很简单了吧，父元素和子元素同时左浮动，然后父元素相对左移动50%，再然后子元素相对右移动50%，或者子元素相对左移动-50%也就可以了。如此简单如此神奇。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sshfs]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/30/sshfs/"/>
    <updated>2013-05-30T16:57:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/30/sshfs</id>
    <content type="html"><![CDATA[<ul>
<li>今天看到sshfs可以像mount一样挂上磁盘非常方便记录一下</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>sshfs user@hostname:path mount_point
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cacti spine的安装配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/29/cacti-spinede-an-zhuang-pei-zhi/"/>
    <updated>2013-05-29T15:35:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/29/cacti-spinede-an-zhuang-pei-zhi</id>
    <content type="html"><![CDATA[<ul>
<li>cacti官方有详细的配置流程，这里只是翻译和错误的解决</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://www.cacti.net/downloads/spine/cacti-spine-0.8.8a.tar.gz
</span><span class='line'>tar -zxvf cacti-spine-0.8.8a.tar.gz
</span><span class='line'><span class="nb">cd </span>cacti-spine-0.8.8a/
</span><span class='line'>
</span><span class='line'>./configure
</span><span class='line'><span class="c"># configure: error: Cannot find MySQL headers.  Use --with-mysql= to specify non-default path.</span>
</span><span class='line'><span class="c"># 下载安装mysqlclient开发包</span>
</span><span class='line'>sudo apt-get install libmysqlclient-dev
</span><span class='line'>
</span><span class='line'>./configure
</span><span class='line'><span class="c"># configure: error: Cannot find SNMP headers.  Use --with-snmp= to specify non-default path.</span>
</span><span class='line'><span class="c"># 下载安装snmp开发包</span>
</span><span class='line'>sudo apt-cache search snmp | grep dev
</span><span class='line'>sudo apt-get install libsnmp-dev
</span><span class='line'>
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>搞定配置文件</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cp /usr/local/spine/etc/spine.conf.dist /usr/local/spine/etc/spine.conf
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>admin登录cacti页面, 选择Settings的Paths选项卡，输入完整的spine路径[Alternate Poller Path]</p></li>
<li><p>点击Settings的Poller选项卡，从Poller Type里选择spine</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解决 sysDescr: Unknown Object Identifier (Sub-id not found: (top)  sysDescr)]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/29/sysdescr-unknown-object-identifier-sub-id-not-found-top-sysdescr/"/>
    <updated>2013-05-29T11:58:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/29/sysdescr-unknown-object-identifier-sub-id-not-found-top-sysdescr</id>
    <content type="html"><![CDATA[<ul>
<li>ubuntu安装snmp很方便</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install snmp snmpd</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置我就跳过了，直接测试，问题来了</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpwalk -v 2c -c public 127.0.0.1 sysDescr
</span><span class='line'>
</span><span class='line'># 显示 sysDescr: Unknown Object Identifier (Sub-id not found: (top) -&gt; sysDescr)</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>网上搜一下，没有正确可行的办法，但是也是有收获</p></li>
<li><p>直接使用snmpwalk -v 2c -c public 127.0.0.1 是没有问题的</p></li>
<li>那就说明问题出在mibs上</li>
<li>尝试解决一下</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install snmp-mibs-downloader
</span><span class='line'>
</span><span class='line'>vim /etc/snmp/snmp.conf
</span><span class='line'>#全部注释下～～～
</span><span class='line'>#再测试就没问题了，使用了新的mibs
</span><span class='line'>snmpwalk -v 2c -c public 127.0.0.1 sysDescr
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sqlalchemy 定义模型]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/24/sqlalchemy-ding-yi-mo-xing/"/>
    <updated>2013-05-24T17:04:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/24/sqlalchemy-ding-yi-mo-xing</id>
    <content type="html"><![CDATA[<ol>
<li>下面是一个基本的模型，对应db的一张表</li>
<li>nullable 代表是否可以为空</li>
<li>server_default 代表默认值</li>
<li>常用类型：Integer, String, DateTime, TIMESTAMP, DECIMAL</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># coding: utf-8</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="kn">import</span> <span class="n">text</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">DECIMAL</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
</span><span class='line'><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Member</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span><span class='line'>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;tbl_member&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ext_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
</span><span class='line'>    <span class="n">username</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="n">my_desc</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">createtime</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="n">modifytime</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">text</span><span class="p">(</span><span class="s">&#39;CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#39;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[yii 隐藏index.php RESTful nginx配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/24/yii-yin-cang-index-dot-php/"/>
    <updated>2013-05-24T14:36:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/24/yii-yin-cang-index-dot-php</id>
    <content type="html"><![CDATA[<ol>
<li>默认yii不使用RESTful的url，比如: index.php/news/list?category=12</li>
<li><p>通过简单的配置可以美化url，比如：/news/list/category/12</p></li>
<li><p>修改main.php配置</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;urlManager&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;urlFormat&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;path&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;showScriptName&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;rules&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>修改nginx.php配置</li>
</ul>


<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">server {</span>
</span><span class='line'><span class="x">    listen          11111;</span>
</span><span class='line'><span class="x">    index           index-test.php index.html;</span>
</span><span class='line'><span class="x">    root            /xxxxxx/xxxxx/project/yii-test;</span>
</span><span class='line'><span class="x">    charset         utf-8;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    client_max_body_size 20m;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    # 是否存在文件，不存在就rewrite index-test.php，生产应该是index.php</span>
</span><span class='line'><span class="x">    location / {</span>
</span><span class='line'><span class="x">        if (!-e $request_filename){</span>
</span><span class='line'><span class="x">            rewrite ^/(.*) /index-test.php last;</span>
</span><span class='line'><span class="x">        }</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'>
</span><span class='line'><span class="x">    # 缓存资源文件</span>
</span><span class='line'><span class="x">    location ~* \.(js|css|png|jpg|jpeg|gif|ico|swf)$ {</span>
</span><span class='line'><span class="x">        expires 24h;</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'>
</span><span class='line'><span class="x">    # 定义path_info，并交给fpm处理</span>
</span><span class='line'><span class="x">    location ~ \.php {</span>
</span><span class='line'><span class="x">        fastcgi_split_path_info     ^(.+\.php)(/.*)$;</span>
</span><span class='line'><span class="x">        fastcgi_param               PATH_INFO                               $fastcgi_script_name;</span>
</span><span class='line'><span class="x">        include                     /usr/local/etc/nginx/fastcgi.conf;</span>
</span><span class='line'><span class="x">        fastcgi_pass                127.0.0.1:10001;</span>
</span><span class='line'><span class="x">        fastcgi_index               index-test.php;</span>
</span><span class='line'><span class="x">        expires                     off;</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[yii 用户验证]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/24/yii-yong-hu-yan-zheng/"/>
    <updated>2013-05-24T12:39:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/24/yii-yong-hu-yan-zheng</id>
    <content type="html"><![CDATA[<ol>
<li>yii用户验证其实很简单，但是网络上的文章都写的不够详细【包括官方的】</li>
<li>先介绍一下基于session的用户验证</li>
<li>用cookie让用户可以保持状态，再介绍一下安全性</li>
</ol>


<!-- more -->


<ul>
<li>main.php 配置登录页面</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;loginUrl&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>在控制器中增加权限控制和规则</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">CController</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1"># 让控制器加入到权限控制</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">filters</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="s1">&#39;accessControl&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># 让edit,view这2个action访客无法直接使用，跳转到登录界面</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">accessRules</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;deny&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="s1">&#39;actions&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
</span><span class='line'>                <span class="s1">&#39;users&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionEdit</span><span class="p">()</span> <span class="p">{</span> <span class="nb">var_dump</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionView</span><span class="p">()</span> <span class="p">{</span> <span class="nb">var_dump</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>创建继承CUserIdentity的用户标识类给登录时使用</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">UserIdentity</span> <span class="k">extends</span> <span class="nx">CUserIdentity</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">authenticate</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">            这里可以写判断是否有用户的逻辑</span>
</span><span class='line'>
</span><span class='line'><span class="cm">            需要存储到session里的数据可以这样写</span>
</span><span class='line'><span class="cm">            $this-&gt;setState(&#39;nickname&#39;, $member-&gt;nickname);</span>
</span><span class='line'><span class="cm">        */</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_id</span> <span class="o">=</span> <span class="nv">$member</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_id</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>用户登陆的控制器</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$req</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$user</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionLogin</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$reason</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span><span class="o">-&gt;</span><span class="na">isPostRequest</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="nv">$identity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserIdentity</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$identity</span><span class="o">-&gt;</span><span class="na">authenticate</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$identity</span><span class="p">);</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">returnUrl</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$reason</span> <span class="o">=</span> <span class="nv">$identity</span><span class="o">-&gt;</span><span class="na">errorMessage</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="o">=&gt;</span><span class="nv">$reason</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<hr />


<ul>
<li>增加登录cookie保持用户登录状态，改完赶紧尝试一下吧</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># 修改main.php,允许自动登录</span>
</span><span class='line'><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;allowAutoLogin&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;loginUrl&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">),</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 修改UserController设置7天有效期</span>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$identity</span><span class="p">,</span> <span class="mi">86400</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>不经问自己：这样的cookie安全吗？会不会被利用？</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">1. 不应该把敏感信息保存到state里，比如密码</span>
</span><span class='line'><span class="x">2. yii内部有cookie校验机制，改动的cookie是无法生效的，可以看下/protected/runtime/state.bin（这就是验证随机的key）</span>
</span><span class='line'><span class="x">3. 想要知道yii内部生成key源码可以参考 CSecurityManager</span>
</span><span class='line'>
</span><span class='line'><span class="x">protected function generateRandomKey()</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    return sprintf(&#39;%08x%08x%08x%08x&#39;,mt_rand(),mt_rand(),mt_rand(),mt_rand());</span>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[yii 文件日志]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/23/yii-ri-zhi/"/>
    <updated>2013-05-23T15:12:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/23/yii-ri-zhi</id>
    <content type="html"><![CDATA[<ul>
<li>yii的文件日志默认在runtime下的application.log</li>
</ul>


<!-- more -->


<ul>
<li>yii配置文件日志和记录等级</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="c1"># main.php配置文件, 生产环境只记录error和warning</span>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;log&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CLogRouter&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;routes&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span>
</span><span class='line'>                <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CFileLogRoute&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="s1">&#39;levels&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;error, warning&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># test.php配置文件，线下测试所有的都记录下来</span>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;log&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CLogRouter&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;routes&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span>
</span><span class='line'>                <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CFileLogRoute&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="c1">#trace内容很多，一般不开启，用info足够了</span>
</span><span class='line'>                <span class="s1">&#39;levels&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;info, profile, error, warning&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 记录日志, 1.log信息,2.等级,3.分类（分类自定义）</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;info调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_INFO</span><span class="p">,</span> <span class="s1">&#39;test.info&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;profile调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_PROFILE</span><span class="p">,</span> <span class="s1">&#39;test.profile&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;warning调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_WARNING</span><span class="p">,</span> <span class="s1">&#39;test.warning&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;error调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_ERROR</span><span class="p">,</span> <span class="s1">&#39;test.error&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>服务器异常错误，显示错误页面，这样的错误会记录到日志中（因为属于error, warning）</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="c1"># 在main.php中配置errorHandler，统一处理异常</span>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;errorHandler&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;errorAction&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;site/error&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 在Site控制器里增加error的action，处理错误</span>
</span><span class='line'><span class="k">class</span> <span class="nc">SiteController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionIndex</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1"># 产生一个异常</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">CHttpException</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;调用接口失败&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionError</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$error</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">errorHandler</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$error</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;is_debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">YII_DEBUG</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;/error&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jquery validation]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/23/jquery-validation/"/>
    <updated>2013-05-23T12:41:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/23/jquery-validation</id>
    <content type="html"><![CDATA[<h3>表单验证在网站开发中是肯定有的，还好jquery在这方面已经做的很好了</h3>

<ul>
<li>自定义一种验证类型</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">jQuery</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span>
</span><span class='line'>    <span class="s2">&quot;cellphone&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">optional</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">||</span> <span class="sr">/^1\d{10}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s2">&quot;请输入有效的手机号码&quot;</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>定义规则和错误显示</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form&#39;</span><span class="p">).</span><span class="nx">validate</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">nickname</span><span class="o">:</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">email</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">email</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">password</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">minlength</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">messages</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">nickname</span><span class="o">:</span> <span class="s2">&quot;请输入昵称&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">email</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="s2">&quot;请输入邮箱&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">email</span><span class="o">:</span> <span class="s2">&quot;请输入有效的邮箱&quot;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">password</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="s2">&quot;请输入密码&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">minlength</span><span class="o">:</span> <span class="s2">&quot;密码的长度不能小于6位&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">errorElement</span><span class="o">:</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">wrapper</span><span class="o">:</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">errorPlacement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">element</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">after</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">highlight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">errorClass</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border&#39;</span><span class="p">,</span> <span class="s1">&#39;1px solid red&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">unhighlight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">errorClass</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border&#39;</span><span class="p">,</span> <span class="s1">&#39;1px solid #777&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">submitHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Submitted!&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[英文Ubuntu安装中文包]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/02/ying-wen-ubuntuan-zhuang-zhong-wen-bao/"/>
    <updated>2013-05-02T18:07:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/02/ying-wen-ubuntuan-zhuang-zhong-wen-bao</id>
    <content type="html"><![CDATA[<h3>查看系统内安装的locale：</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>locale -a
</span><span class='line'># 如果没有“zh-CN.UTF-8”，则表示系统内没有安装中文locale。这会导致“LC_CTYPE: cannot change locale (zh_CN.UTF-8)”的警告。</span></code></pre></td></tr></table></div></figure>


<h3>输入以下命令安装：</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/share/locales 
</span><span class='line'>sudo ./install-language-pack zh_CN</span></code></pre></td></tr></table></div></figure>


<ul>
<li>然后重开终端，就可以发现中文locale已经安装完毕，警告已经不再出现了。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[主从切换]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/07/zhu-cong-qie-huan/"/>
    <updated>2013-04-07T20:32:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/07/zhu-cong-qie-huan</id>
    <content type="html"><![CDATA[<h3>1个master，1个slave1，1个slave2，关闭master，让slave1做master，slave2同步新master</h3>

<ul>
<li>slave1开启同步账号</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; grant replication slave on *.* to 'backup'@'192.168.0.152' identified by '123456';
</span><span class='line'>mysql &gt; grant replication slave on *.* to 'backup'@'192.168.0.153' identified by '123456';
</span><span class='line'>mysql &gt; flush privileges;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>锁住master的写</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; flush tables with read lock;
</span><span class='line'>
</span><span class='line'># 关闭锁的命令：unlock tables;</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>查看slave1和slave2的同步状态</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; show processlist;
</span><span class='line'>
</span><span class='line'># 确保 Slave has read all relay log; waiting for the slave I/O thread to update it</span></code></pre></td></tr></table></div></figure>


<ul>
<li>修改slave1的配置，并重启</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bind-address = 0.0.0.0
</span><span class='line'>
</span><span class='line'>$ sudo service mysql restart</span></code></pre></td></tr></table></div></figure>


<ul>
<li>停止slave1的slave，设置为master</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; stop slave;
</span><span class='line'>mysql &gt; reset master;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>停止slave2的slave，重新设置master</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; stop slave;
</span><span class='line'>
</span><span class='line'>mysql &gt; change master to
</span><span class='line'>      &gt; master_host = '192.168.0.151',
</span><span class='line'>      &gt; master_user = 'backup',
</span><span class='line'>      &gt; master_password = '123456';
</span><span class='line'>
</span><span class='line'>mysql&gt; start slave;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>测试是否成功</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; create table `test` ( id int not null auto_increment, `name` varchar(100) not null, primary key (`id`) );
</span><span class='line'>mysql &gt; drop table test;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
