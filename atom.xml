<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[老虎的眼睛]]></title>
  <link href="http://www.wanghd.com/atom.xml" rel="self"/>
  <link href="http://www.wanghd.com/"/>
  <updated>2013-03-08T10:49:44+08:00</updated>
  <id>http://www.wanghd.com/</id>
  <author>
    <name><![CDATA[王惠达 huida wanghuida]]></name>
    <email><![CDATA[wanghuida258@yahoo.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[sqlalchemy 自动创建表]]></title>
    <link href="http://www.wanghd.com/blog/2013/03/05/sqlalchemy-zi-dong-chuang-jian-biao/"/>
    <updated>2013-03-05T17:15:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/03/05/sqlalchemy-zi-dong-chuang-jian-biao</id>
    <content type="html"><![CDATA[<h3>声明1个映射关系，然后如果没有表，那就自动创建</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># coding: utf-8</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">sqlalchemy</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">DECIMAL</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="kn">import</span> <span class="n">text</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</span><span class='line'><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span><span class='line'>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;users&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
</span><span class='line'>    <span class="n">fullname</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span class='line'>    <span class="n">password</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">server_default</span><span class="o">=</span><span class="n">text</span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">fid</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">text</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">d</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DECIMAL</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">text</span><span class="p">(</span><span class="s">&#39;0.0&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">creation</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="c"># updated = Column(TIMESTAMP, nullable=False, server_default=text(&#39;current_timestamp on update current_timestamp&#39;))</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">&#39;sqlite:///test.db&#39;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h3>自动生成语句执行</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="mi">2013</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">10</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span><span class="mi">805</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span>
</span><span class='line'><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">users</span> <span class="p">(</span>
</span><span class='line'>    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">name</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
</span><span class='line'>    <span class="n">fullname</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
</span><span class='line'>    <span class="n">password</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="n">DEFAULT</span> <span class="mi">123</span><span class="p">,</span>
</span><span class='line'>    <span class="n">fid</span> <span class="n">INTEGER</span> <span class="n">DEFAULT</span> <span class="mi">1</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">d</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">DEFAULT</span> <span class="mf">0.0</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">creation</span> <span class="n">DATETIME</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="mi">2013</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">10</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span><span class="mi">805</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span> <span class="p">()</span>
</span><span class='line'><span class="mi">2013</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">10</span><span class="p">:</span><span class="mo">05</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span><span class="mi">808</span> <span class="n">INFO</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span> <span class="n">COMMIT</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mysql 安全]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/27/mysql-an-quan/"/>
    <updated>2013-02-27T14:57:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/27/mysql-an-quan</id>
    <content type="html"><![CDATA[<ul>
<li><p>如果客户端和服务器端的连接需要跨越并通过不可信任的网络，那么就需要使用SSH隧道来加密该连接的通信。一般情况下mysql不直接对外，只提供<code>内部访问</code>。</p></li>
<li><p>用GRANT和REVOKE语句来控制对MySQL的访问。不要授予超过需求的权限。决不能为所有主机授权。</p></li>
<li><p>不要让任何人(除了MySQL root账户)访问mysql数据库中的<code>user表</code>！这很关键。加密的密码才是MySQL中的真正的密码。</p></li>
<li><p>不要将<code>纯文本密码</code>保存到数据库中。如果你的计算机有安全危险，入侵者可以获得所有的密码并使用它们。相反，应使用MD5()、SHA1()或单向哈希函数。</p></li>
<li><p>不要从词典中选择密码。有专门的程序可以破解它们。</p></li>
</ul>


<!-- more -->


<ul>
<li><p>试试从Internet使用nmap工具扫描端口。MySQL默认使用端口3306。或者telnet ip 3306。</p></li>
<li><p>如果某个用户输入<code>; DROP DATABASE mysql;</code>等内容，应确保你的应用程序保持安全。</p></li>
<li><p>一定要记住还应检查数字数据。如果当用户输入值234时，应用程序生成查询SELECT * FROM table WHERE ID=234，用户可以输入值<code>234 OR 1=1</code>使应用程序生成查询SELECT * FROM table WHERE ID=234 OR 1=1。结果是服务器查找表内的每个记录。</p></li>
<li><p>学会使用tcpdump和strings工具。在大多数情况下，你可以使用下面的命令检查是否MySQL数据流未加密</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>shell&gt; tcpdump -l -i eth0 -w - src or dst port 3306 | strings</span></code></pre></td></tr></table></div></figure>


<ul>
<li>对所有MySQL用户使用密码。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>shell&gt; mysql -u root
</span><span class='line'>mysql&gt; UPDATE mysql.user SET Password=PASSWORD('newpwd')
</span><span class='line'>    -&gt; WHERE User='root';
</span><span class='line'>mysql&gt; FLUSH PRIVILEGES;</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>绝对不要作为Unix的root用户运行MySQL服务器。这样做非常危险，因为任何具有FILE权限的用户能够用root创建文件(例如，~root/.bashrc)。为了防止，mysqld拒绝用root运行，除非使用&#8211;user=root选项明显指定。</p></li>
<li><p>确保mysqld运行时，<code>只使用对数据库目录具有读或写权限的Unix用户来运行</code>。</p></li>
<li><p>不要将PROCESS或SUPER权限授给非管理用户。mysqladmin processlist的输出显示出当前执行的查询正文，如果另外的用户发出一个UPDATE user SET password=PASSWORD(&#8216;not_secure&#8217;)查询，被允许执行那个命令的任何用户可能看得到。 mysqld为有SUPER权限的用户专门保留一个额外的连接，因此即使所有普通连接被占用，MySQL root用户仍可以登录并检查服务器的活动。 可以使用SUPER权限来终止客户端连接，通过更改系统变量的值更改服务的器操作，并控制复制服务器。</p></li>
<li><p>不要向非管理用户授予FILE权限。有这权限的任何用户能在拥有mysqld守护进程权限的文件系统那里写一个文件。</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mysql 管理语句]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/27/mysql-guan-li-yu-ju/"/>
    <updated>2013-02-27T14:53:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/27/mysql-guan-li-yu-ju</id>
    <content type="html"><![CDATA[<h3>创建用户，设置密码，赋予权限</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; grant all privileges on mmd.* to 'mmd'@'localhost' identified  by '123456';
</span><span class='line'>mysql &gt; flush privileges;
</span><span class='line'>mysql &gt; drop user
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># mysql 5.5+默认本地连接，请修改bind_address为0.0.0.0才能支持网络连接
</span><span class='line'>mysql &gt; grant select,update,insert,delete on mmd.* to 'mmd'@'%' identified  by '123456';
</span><span class='line'>mysql &gt; flush privileges;
</span><span class='line'>mysql &gt; show grants for 'mmd'@'%';
</span><span class='line'>
</span><span class='line'>mysql &gt; set password for 'mmd'@'%' = password('654321');</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h3>create 数据库，数据表</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; create table staff ( 
</span><span class='line'>      &gt; id int not null auto_increment primary key, 
</span><span class='line'>      &gt; username varchar(50) not null, 
</span><span class='line'>      &gt; `desc` text 
</span><span class='line'>      &gt; ) engine=innodb default character set=utf8;
</span><span class='line'>
</span><span class='line'>mysql &gt; insert into staff (id,username,`desc`) values (NULL,'王惠达','测试数据');
</span><span class='line'>
</span><span class='line'>mysql &gt; select * from staff;</span></code></pre></td></tr></table></div></figure>


<h3>修改表结构</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msyql &gt; alter table staff modify username varchar(100) not null;
</span><span class='line'>
</span><span class='line'>mysql &gt; alter table staff add creation timestamp; 
</span><span class='line'>
</span><span class='line'>mysql &gt; alter table staff drop creation;</span></code></pre></td></tr></table></div></figure>


<h3>创建，删除 index</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; create index all_field on staff (id,username);
</span><span class='line'>
</span><span class='line'>mysql &gt; create index one_field on staff (username);
</span><span class='line'>
</span><span class='line'>mysql &gt; drop index one_field on staff;
</span></code></pre></td></tr></table></div></figure>


<h3>explain</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; explain select * from staff where username like '%惠达%'
</span><span class='line'>
</span><span class='line'>+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
</span><span class='line'>| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |
</span><span class='line'>+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
</span><span class='line'>|  1 | SIMPLE      | staff | ALL  | NULL          | NULL | NULL    | NULL |    1 | Using where |
</span><span class='line'>+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
</span><span class='line'>1 row in set (0.00 sec)
</span><span class='line'>
</span><span class='line'>mysql &gt; explain select * from staff where id = 1;
</span><span class='line'>
</span><span class='line'>+----+-------------+-------+-------+-------------------+---------+---------+-------+------+-------+
</span><span class='line'>| id | select_type | table | type  | possible_keys     | key     | key_len | ref   | rows | Extra |
</span><span class='line'>+----+-------------+-------+-------+-------------------+---------+---------+-------+------+-------+
</span><span class='line'>|  1 | SIMPLE      | staff | const | PRIMARY,all_field | PRIMARY | 4       | const |    1 |       |
</span><span class='line'>+----+-------------+-------+-------+-------------------+---------+---------+-------+------+-------+
</span><span class='line'>1 row in set (0.00 sec)
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mysql 状态检查]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/27/mysql-zhuang-tai-jian-cha/"/>
    <updated>2013-02-27T14:52:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/27/mysql-zhuang-tai-jian-cha</id>
    <content type="html"><![CDATA[<h3>最简单的status</h3>

<ul>
<li>可以了解一下mysql基本的状态</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mysql -u -p -h 
</span><span class='line'>mysql &gt; status</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>另外可以添加 -i 5 参数，让其每五秒自动刷新一次。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysqladmin -uroot -p密码 status -i 5 </span></code></pre></td></tr></table></div></figure>


<h3>查看mysql详细的状态信息</h3>

<ul>
<li>里面包含mysql所有的状态信息，分散在各处，很难理解，下会再推荐一个更有效的工具</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; show status; (session 级别的)
</span><span class='line'>mysql &gt; show global status; (server 级别的, 一般都使用这个)</span></code></pre></td></tr></table></div></figure>


<h3>mysqlreport</h3>

<ul>
<li>官方网站: http://hackmysql.com/mysqlreport</li>
<li>该工具使用方便，数据也很清晰，非常推荐使用该工具</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./mysqlreport --host=10.0.1.111 --user=**** --password=****</span></code></pre></td></tr></table></div></figure>


<h3>更快速的查看mysql 表缓存</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; show open tables;</span></code></pre></td></tr></table></div></figure>


<h3>show processlist</h3>

<ul>
<li><p>当感觉到每个线程有问题时，可以使用这条命令看下情况</p></li>
<li><p>案例：DBA通知我processlist里有很多空链接，我发现mysql链接都是持久化的。。并且没有关闭</p></li>
</ul>


<h3>show (session | global) variables</h3>

<ul>
<li>查看当前服务器配置变量</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 很多情况下都不希望重启mysql服务，所以可以动态调整变量
</span><span class='line'># 例如输出log
</span><span class='line'>set global log=/tmp/query.log
</span><span class='line'>
</span><span class='line'># 希望重启后也会应用到，可以添加到my.cnf</span></code></pre></td></tr></table></div></figure>


<h3>show table status [from db] [like &#8216;%table%&#8217;]</h3>

<ul>
<li>显示具体某个表的状态信息</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mysql 主从设置]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/27/mysql-zhu-cong-she-zhi/"/>
    <updated>2013-02-27T14:52:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/27/mysql-zhu-cong-she-zhi</id>
    <content type="html"><![CDATA[<h3>设置同步账号</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; grant replication slave on *.* to 'backup'@'%' identified by '123456';
</span><span class='line'>mysql &gt; flush privileges;</span></code></pre></td></tr></table></div></figure>


<h3>master 配置</h3>

<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server-id       = 1
</span><span class='line'>log_bin         = /var/log/mysql/mysql-bin.log
</span><span class='line'>max_binlog_size     = 100M
</span><span class='line'>expire_logs_days    = 10
</span><span class='line'>binlog_do_db        = mmd
</span><span class='line'>
</span><span class='line'>service mysql restart</span></code></pre></td></tr></table></div></figure>


<h3>slave 配置</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server-id           = 2 
</span><span class='line'>log_bin             = /var/log/mysql/mysql-bin.log
</span><span class='line'>expire_logs_days    = 10
</span><span class='line'>max_binlog_size     = 100M
</span><span class='line'>replicate-do-db     = mmd 
</span><span class='line'>read_only           = 1
</span><span class='line'>
</span><span class='line'>service mysql restart</span></code></pre></td></tr></table></div></figure>


<h3>同步现有数据</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 强制读锁
</span><span class='line'>mysql &gt; flush tables with read lock;
</span><span class='line'># 导出数据,如果是myisam表的话，加上--lock-all-tables参数，如果是innodb表的话，加上--single-transaction参数。如果数据量很大，建议停服务生成数据快照
</span><span class='line'>$ mysqldump -uroot -p63137246 --single-transaction mmd &gt; mmd.sql
</span><span class='line'># 记录同步点
</span><span class='line'>mysql &gt; show master status;
</span><span class='line'>+------------------+----------+--------------+------------------+
</span><span class='line'>| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |
</span><span class='line'>+------------------+----------+--------------+------------------+
</span><span class='line'>| mysql-bin.000007 |      887 | mmd          |                  |
</span><span class='line'>+------------------+----------+--------------+------------------+
</span><span class='line'># 关闭读锁
</span><span class='line'>mysql &gt; unlock tables;
</span><span class='line'>
</span><span class='line'>$ scp mmd.sql wanghuida@192.168.30.114:mmd.sql
</span><span class='line'>$ mysql -uroot -p***** mmd &lt; mmd.sql</span></code></pre></td></tr></table></div></figure>


<h3>slave 同步设置</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; change master to
</span><span class='line'>      &gt; master_host='192.168.30.113', 
</span><span class='line'>      &gt; master_user='backup', 
</span><span class='line'>      &gt; master_password='123456', 
</span><span class='line'>      &gt; master_log_file='mysql-bin.000007', 
</span><span class='line'>      &gt; master_log_pos=887;
</span><span class='line'>
</span><span class='line'>mysql &gt; start slave;</span></code></pre></td></tr></table></div></figure>


<h3>附加配置</h3>

<ul>
<li>注释：为了保证事务InnoDB复制设置的最大可能的耐受性和一致性，应在主服务器的my.cnf文件中使用innodb_flush_log_at_trx_commit=1和sync-binlog=1。这样每次提交都会写入日志文件，性能有一些损失</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mysql 优化配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/27/mysql-you-hua-pei-zhi/"/>
    <updated>2013-02-27T14:52:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/27/mysql-you-hua-pei-zhi</id>
    <content type="html"><![CDATA[<p>cache_size</p>

<p>max-connections</p>

<p>thread_cache_size</p>

<p>key_buffer_size
buffer_size
query_cache_limit
query_cache_size</p>

<p>query_cache_size</p>

<p>query_cache_limit</p>

<p>table_cache</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mysql 日志分类]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/27/mysql-ri-zhi-fen-lei/"/>
    <updated>2013-02-27T14:52:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/27/mysql-ri-zhi-fen-lei</id>
    <content type="html"><![CDATA[<h3>general-log : 记录建立的客户端连接和执行的语句。</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># my.cnf 一般不会打开，耗io
</span><span class='line'>general_log_file        = /var/log/mysql/mysql.log
</span><span class='line'>
</span><span class='line'># 当你怀疑在客户端发生了错误并想确切地知道该客户端发送给mysqld的语句时，该日志可能非常有用。
</span><span class='line'># 一般都是临时打开
</span><span class='line'>mysql &gt; show variables like '%general_log%';  
</span><span class='line'>
</span><span class='line'>+------------------+------------------------------+
</span><span class='line'>| Variable_name    | Value                        |
</span><span class='line'>+------------------+------------------------------+
</span><span class='line'>| general_log      | OFF                          |
</span><span class='line'>| general_log_file | /var/lib/mysql/idc08-002.log |
</span><span class='line'>+------------------+------------------------------+
</span><span class='line'>2 rows in set (0.00 sec)
</span><span class='line'>
</span><span class='line'>mysql &gt; SET GLOBAL general_log_file = '/tmp/mysql.log';
</span><span class='line'>mysql &gt; SET GLOBAL general_log = 'ON';
</span><span class='line'>
</span><span class='line'># 已经可以监控请求语句了，用完要记得关闭</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h3>log-bin : 记录所有更改数据的语句。还用于复制。</h3>

<ul>
<li>接替日志: flush logs语句或执行mysqladmin flush-logs</li>
<li>运行服务器时若启用二进制日志则性能大约慢1%。但是，二进制日志的好处，即用于恢复并允许设置复制超过了这个小小的性能损失。</li>
<li>mysqld在每个二进制日志名后面添加一个数字扩展名。每次你启动服务器或刷新日志时该数字则增加。如果当前的日志大小达到max_binlog_size，还会自动创建新的二进制日志。如果你正使用大的事务，二进制日志还会超过max_binlog_size：事务全写入一个二进制日志中，绝对不要写入不同的二进制日志中。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>log_bin             = /var/log/mysql/mysql-bin.log
</span><span class='line'>max_binlog_size     = 100M
</span><span class='line'>expire_logs_days    = 10
</span><span class='line'>#binlog_do_db       = db1,db2,db3
</span><span class='line'>#binlog_ignore_db   = include_database_name</span></code></pre></td></tr></table></div></figure>


<h3>slow-log : 记录所有执行时间超过long_query_time秒的所有查询或不使用索引的查询。</h3>

<ul>
<li>5.1以上的版本已经支持毫秒级</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>log_slow_queries = /var/log/mysql/mysql-slow.log
</span><span class='line'>long_query_time = 0.5 </span></code></pre></td></tr></table></div></figure>


<h3>error-log : 记录启动、运行或停止mysqld时出现的问题。</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># my.cnf
</span><span class='line'>log_error = /var/log/mysql/error.log</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu 网络设置]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/26/ubuntu-wang-luo-she-zhi/"/>
    <updated>2013-02-26T15:22:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/26/ubuntu-wang-luo-she-zhi</id>
    <content type="html"><![CDATA[<h3>ubuntu的网络设置涉及到如下文件：</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/network/interfaces # 网络接口配置，包括网络接口说明、IP地址、子网掩码、网关等
</span><span class='line'>/etc/resolv.conf        # DNS服务器设置
</span><span class='line'>/etc/hostname           # 主机名设置
</span><span class='line'>/etc/hosts              # 域名解析映射
</span><span class='line'>/etc/hosts.allow        # IP访问允许规则
</span><span class='line'>/ect/hosts.deny         # IP访问禁止规则</span></code></pre></td></tr></table></div></figure>


<ul>
<li>修改网络配置文件后，要重启网络接口，使用命令：/etc/init.d/networking restart</li>
<li>重启单个网口可以使用ifdown eth0,ifup eth0</li>
</ul>


<!-- more -->


<h3>dhcp</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/network/interfaces
</span><span class='line'>auto eth0               # 设置eth0开机自动加载
</span><span class='line'>iface eth0 inet dhcp    # 定义网络接口eth0为Internet，DHCP方式。</span></code></pre></td></tr></table></div></figure>


<h3>static</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>auto eth0
</span><span class='line'>iface eth inet static
</span><span class='line'>address 192.168.0.110
</span><span class='line'>gateway 192.168.0.1
</span><span class='line'>netmask 255.255.255.0</span></code></pre></td></tr></table></div></figure>


<h3>dns</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/resolv.conf
</span><span class='line'>
</span><span class='line'>nameserver x.x.x.x  # 首要DNS服务器
</span><span class='line'>nameserver x.x.x.x  # 备用DNS服务器</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu 服务器基础配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/26/fu-wu-qi-ji-chu-pei-zhi/"/>
    <updated>2013-02-26T12:58:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/26/fu-wu-qi-ji-chu-pei-zhi</id>
    <content type="html"><![CDATA[<h3>配置.profile</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export EDITOR=vim
</span><span class='line'>
</span><span class='line'># set terminal color
</span><span class='line'>PS1='\[\e[1;32m\]\u\[\e[m\]@' # user
</span><span class='line'>PS1=$PS1'\[\e[1;31m\]\h\[\e[m\] ' # host
</span><span class='line'>PS1=$PS1'\[\e[1;34m\]\W\[\e[m\] ' # wd
</span><span class='line'>#PS1=$PS1'\[\e[1;33m\]$(__ruby_version)\[\e[m\] ' # rvm version
</span><span class='line'>#PS1=$PS1'\[\e[1;32m\]$(__git_ps1)\[\e[m\] ' # git
</span><span class='line'>export PS1 
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h3>配置.vimrc</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>set nocompatible
</span><span class='line'>set backspace=2
</span><span class='line'> 
</span><span class='line'>set nu
</span><span class='line'>syntax on
</span><span class='line'> 
</span><span class='line'>set autoindent
</span><span class='line'>set softtabstop=4
</span><span class='line'>set tabstop=4
</span><span class='line'>set shiftwidth=4
</span><span class='line'>set expandtab
</span><span class='line'> 
</span><span class='line'>set showmatch
</span><span class='line'>set ruler
</span><span class='line'> 
</span><span class='line'>filetype plugin on
</span><span class='line'>set laststatus=2
</span><span class='line'>set encoding=utf-8
</span><span class='line'>set hlsearch
</span><span class='line'>set showcmd
</span><span class='line'> 
</span><span class='line'>set scrolloff=4
</span><span class='line'>set ignorecase smartcase
</span><span class='line'> </span></code></pre></td></tr></table></div></figure>


<h3>配置sudo</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>visudo 
</span><span class='line'># 请放在最下面
</span><span class='line'>wanghuida   ALL=(ALL) NOPASSWD:ALL</span></code></pre></td></tr></table></div></figure>


<h3>配置ssh</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install ssh
</span><span class='line'>
</span><span class='line'>sudo vim /etc/ssh/sshd_config
</span><span class='line'>PasswordAuthentication no
</span><span class='line'>
</span><span class='line'>sudo /etc/init.d/ssh restart
</span><span class='line'>
</span><span class='line'>mkdir .ssh
</span><span class='line'>chmod 700 .ssh
</span><span class='line'>cd ssh
</span><span class='line'>touch authorized_keys
</span><span class='line'># 增加pub key进去就可以了</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[flask nginx uwsgi 部署]]></title>
    <link href="http://www.wanghd.com/blog/2013/02/01/flask-nginx-uwsgibu-shu/"/>
    <updated>2013-02-01T14:10:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/02/01/flask-nginx-uwsgibu-shu</id>
    <content type="html"><![CDATA[<h3>安装 uwsgi</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install uwsgi</span></code></pre></td></tr></table></div></figure>


<h3>安装 nginx</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install nginx </span></code></pre></td></tr></table></div></figure>


<h3>配置Flask环境</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir test
</span><span class='line'>$ cd test
</span><span class='line'>$ virtualevn sandbox
</span><span class='line'>$ . sandbox/bin/activate
</span><span class='line'>$ pip install Flask</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<h3>创建一个Flask项目</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ touch test.py
</span><span class='line'>
</span><span class='line'># 内容如下
</span><span class='line'>
</span><span class='line'>from flask import Flask
</span><span class='line'>
</span><span class='line'>app = Flask(__name__)
</span><span class='line'>
</span><span class='line'>@app.route('/')
</span><span class='line'>def hello():
</span><span class='line'>    return 'Hello World'
</span><span class='line'>
</span><span class='line'>if __name__ == '__main__':
</span><span class='line'>    app.run()
</span></code></pre></td></tr></table></div></figure>


<h3>创建uwsgi配置文件</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ touch test_config.xml
</span><span class='line'>
</span><span class='line'>&lt;uwsgi&gt;
</span><span class='line'>    &lt;pythonpath&gt;/Users/william/project/test&lt;/pythonpath&gt;
</span><span class='line'>    &lt;module&gt;test&lt;/module&gt;
</span><span class='line'>    &lt;callable&gt;app&lt;/callable&gt;
</span><span class='line'>    &lt;socket&gt;/tmp/uwsgi.sock&lt;/socket&gt;
</span><span class='line'>    &lt;master/&gt;
</span><span class='line'>    &lt;processes&gt;4&lt;/processes&gt;
</span><span class='line'>    &lt;memory-report/&gt;
</span><span class='line'>&lt;/uwsgi&gt;
</span></code></pre></td></tr></table></div></figure>


<h3>nginx 配置</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server {
</span><span class='line'>    listen 80;
</span><span class='line'>    server_name www.test.com;
</span><span class='line'>
</span><span class='line'>    location / {
</span><span class='line'>        include uwsgi_params;
</span><span class='line'>        uwsgi_pass unix:/tmp/uwsgi.sock; 
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>启动服务</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo nginx -s reload
</span><span class='line'>
</span><span class='line'># 支持virtualenv, uswgi还可以--py-auto-reload
</span><span class='line'>sudo uwsgi -x /Users/william/project/test/test_config.xml --virtualenv sandbox 
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[游览器缓存解析]]></title>
    <link href="http://www.wanghd.com/blog/2013/01/18/you-lan-qi-huan-cun-jie-xi/"/>
    <updated>2013-01-18T19:32:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/01/18/you-lan-qi-huan-cun-jie-xi</id>
    <content type="html"><![CDATA[<h3>游览器缓存：可以通过如下四种方式进行设置</h3>

<ol>
<li>Expire: 直接设置过期时间(不做详细解释，用Cache-Control更好)</li>
<li>Cache-Control: HTTP 1.1用Cache-Control代替Expire，Cache-Control比Expire更方便，功能更多。不需要访问服务器端</li>
<li>Last-Modified: 用来设置最后更新时间。需要访问服务器端，如果没有更新直接使用304，节省网络流量和网络传输时间</li>
<li>ETag: 用来设置唯一标识。需要访问服务器端，和last-modified一样</li>
</ol>


<!-- more -->


<h3>Cache-Control</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Cache-Control: max-age=120, must-revalidate&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;cache cache&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://www.wanghd.com/images/post/cache-control.jpg" title="cache-control" alt="cache-control" /></p>

<ul>
<li>刷新(cmd + r)，强刷(shift + cmd + r)，都会访问服务器, 因为这两种方式游览器会绕过本地缓存。尝试打开一个新的tab访问，没有和服务器交互。</li>
<li>windows用户的刷新(F5)，强刷(ctrl + F5)</li>
</ul>


<h3>Last-Modified</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$time</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;2013-01-18&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Last-Modified: &quot;</span> <span class="o">.</span> <span class="nb">gmdate</span><span class="p">(</span><span class="s2">&quot;D, d M Y H:i:s&quot;</span><span class="p">,</span> <span class="nv">$time</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; GMT&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$modified_since</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_IF_MODIFIED_SINCE&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_IF_MODIFIED_SINCE&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$modified_since</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$modified_since</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$modified_since</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$time</span> <span class="o">==</span> <span class="nv">$modified_since</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;hit&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;no hit&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://www.wanghd.com/images/post/last-modified.jpg" title="last-modified" alt="last-modified" /></p>

<p><img src="http://www.wanghd.com/images/post/last-modified-ret.jpg" title="last-modified-ret" alt="last-modified-ret" /></p>

<ul>
<li>第一次访问显示no hit，刷新则命中缓存显示hit(一般304处理，我这里只是举例)。强刷则会显示no hit，可见游览器的强刷是有特别用处的</li>
</ul>


<h3>ETag</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$etag</span> <span class="o">=</span> <span class="s1">&#39;test-etag&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$none_match</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_IF_NONE_MATCH&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$none_match</span> <span class="o">==</span> <span class="nv">$etag</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">header</span><span class="p">(</span><span class="s2">&quot;HTTP/1.1 304 Not Modified&quot;</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="mi">304</span><span class="p">);</span>
</span><span class='line'>    <span class="k">exit</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;ETag: </span><span class="si">{</span><span class="nv">$etag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;test ok!&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://www.wanghd.com/images/post/etag.jpg" title="etag" alt="etag" /></p>

<p><img src="http://www.wanghd.com/images/post/etag304.jpg" title="etag304" alt="etag304" /></p>

<ul>
<li>第一次访问http返回200，显示test ok!。刷新http返回304，使用本地缓存，显示test ok!。强刷则绕过本地缓存，http返回200，可见和last-modified一样</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RTXLDAP教程]]></title>
    <link href="http://www.wanghd.com/blog/2013/01/10/rtxldapjiao-cheng/"/>
    <updated>2013-01-10T10:14:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/01/10/rtxldapjiao-cheng</id>
    <content type="html"><![CDATA[<h3>名词解释</h3>

<ol>
<li>RTX: 腾讯出的企业沟通工具</li>
<li>LDAP: 关于人或者其他信息的集中存储，微软的AD就是LDAP的一种</li>
<li>RTXLDAP: 基于RTX的SDK开发出的第三方工具，可以同步LDAP用户，可以RTX与LDAP单点登陆。支持RTX最新版本</li>
</ol>


<!-- more -->


<h3>配置使用</h3>

<ul>
<li>获取源码</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git@github.com:wanghuida/RTXLDAP.git</span></code></pre></td></tr></table></div></figure>


<ul>
<li>建议使用vs 2008打开</li>
</ul>


<p><img src="http://www.wanghd.com/images/post/rtxldap1.jpg" title="rtxldap1" alt="rtxldap1" /></p>

<ul>
<li>修改App.config配置文件</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- 域 --&gt;
</span><span class='line'>&lt;add key="DomainName" value="192.168.1.100/DC=home,DC=net" /&gt;
</span><span class='line'>&lt;!-- 域用户,用来读取所有域用户信息 --&gt;
</span><span class='line'>&lt;add key="DomainUser" value="wanghuida" /&gt;
</span><span class='line'>&lt;!-- 域用户密码 --&gt;
</span><span class='line'>&lt;add key="DomainPwd" value="123456" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- RTX服务IP，建议在同一台,可以免去其他配置 --&gt;
</span><span class='line'>&lt;add key="RTXIP" value="127.0.0.1"/&gt;
</span><span class='line'>&lt;!-- RTX服务端口 --&gt;
</span><span class='line'>&lt;add key="RTXPort"  value="8006"/&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- 标识，随意修改，不重复即可 --&gt;
</span><span class='line'>&lt;add key="AppGUID" value="{193947E5-E990-4af8-A954-D358B385F099}"/&gt;
</span><span class='line'>&lt;!-- 标识，随意修改，不重复即可 --&gt;
</span><span class='line'>&lt;add key="AppName" value="WanghuidaRtxLdap"/&gt;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>F5启动调试</li>
</ul>


<p><img src="http://www.wanghd.com/images/post/rtxldap2.jpg" title="rtxldap2" alt="rtxldap2" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[date函数的误用]]></title>
    <link href="http://www.wanghd.com/blog/2013/01/06/datehan-shu-de-wu-yong/"/>
    <updated>2013-01-06T17:22:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/01/06/datehan-shu-de-wu-yong</id>
    <content type="html"><![CDATA[<h3>需求：得到给定日期为一年中的第几周，并取得该周的年份</h3>

<ul>
<li>产生bug的写法</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nv">$time_2012_12_31</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">2012</span><span class="p">);</span>
</span><span class='line'><span class="nv">$week_2012_12_31</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="nv">$time_2012_12_31</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;2012-12-31: week is </span><span class="si">{</span><span class="nv">$week_2012_12_31</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$error_year_2012_12_31</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="nv">$time_2012_12_31</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;2012-12-31: error year is </span><span class="si">{</span><span class="nv">$error_year_2012_12_31</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#输出错误的结果</span>
</span><span class='line'><span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="o">:</span> <span class="nx">week</span> <span class="nx">is</span> <span class="mo">01</span>
</span><span class='line'><span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="o">:</span> <span class="nx">error</span> <span class="nx">year</span> <span class="nx">is</span> <span class="mi">2012</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>正确的写法，统一采用ISO-8601标准</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nv">$time_2012_12_31</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">2012</span><span class="p">);</span>
</span><span class='line'><span class="nv">$week_2012_12_31</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="nv">$time_2012_12_31</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;2012-12-31: week is </span><span class="si">{</span><span class="nv">$week_2012_12_31</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$year_2012_12_31</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="nv">$time_2012_12_31</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;2012-12-31: year is </span><span class="si">{</span><span class="nv">$year_2012_12_31</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#输出正确的结果</span>
</span><span class='line'><span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="o">:</span> <span class="nx">week</span> <span class="nx">is</span> <span class="mo">01</span>
</span><span class='line'><span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="o">:</span> <span class="nx">year</span> <span class="nx">is</span> <span class="mi">2013</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jquery在firefox下无法autocomplete]]></title>
    <link href="http://www.wanghd.com/blog/2013/01/04/jqueryzai-firefoxxia-wu-fa-autocomplete/"/>
    <updated>2013-01-04T17:29:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/01/04/jqueryzai-firefoxxia-wu-fa-autocomplete</id>
    <content type="html"><![CDATA[<h4>jquery的autocomplete中文输入在firefox无法正常使用</h4>

<ul>
<li>firefox下用input事件触发keydown即可</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$('元素').bind('input', function(){
</span><span class='line'>    $(this).trigger('keydown');
</span><span class='line'>}).bind("keydown", function(event){
</span><span class='line'>    事件
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[System.out.println 乱码]]></title>
    <link href="http://www.wanghd.com/blog/2012/12/17/system-dot-out-dot-printlnluan-ma/"/>
    <updated>2012-12-17T22:30:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2012/12/17/system-dot-out-dot-printlnluan-ma</id>
    <content type="html"><![CDATA[<h3>今天郁闷发现eclipse控制中文乱码</h3>

<ul>
<li>在网上找答案真心蛋疼，说啥的都有</li>
<li>特此在这里记录一下</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Run Configurations... -&gt; Common选项卡 -&gt; Encoding区，选择Other UTF-8</span></code></pre></td></tr></table></div></figure>


<p><img src="http://www.wanghd.com/images/post/console-messy-code.jpg" title="console messy code" alt="console messy code" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mogilefs设备损坏处理流程]]></title>
    <link href="http://www.wanghd.com/blog/2012/11/25/mogilefsshe-bei-sun-pi-chu-li-liu-cheng/"/>
    <updated>2012-11-25T19:34:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2012/11/25/mogilefsshe-bei-sun-pi-chu-li-liu-cheng</id>
    <content type="html"><![CDATA[<ul>
<li>这里单个dev对应一个磁盘,假设是sdb</li>
<li>文件系统使用xfs</li>
<li>mogstored使用nginx</li>
</ul>


<p>1.把磁盘标记为dead</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mogadm device mark &lt;hostname&gt; &lt;devid&gt; &lt;status&gt;
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<p>2.格式化新磁盘或损坏的磁盘, 并挂到新的目录</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkfs.xfs -f -i <span class="nv">size</span><span class="o">=</span>512 -l <span class="nv">size</span><span class="o">=</span>128m,lazy-count<span class="o">=</span>1 -d <span class="nv">agcount</span><span class="o">=</span>16 /dev/sdb
</span><span class='line'>
</span><span class='line'>mkdir -p /var/mogdata/<span class="o">{</span>new-dev<span class="o">}</span>
</span><span class='line'>
</span><span class='line'>mount -t xfs -o noatime,noikeep,logbufs<span class="o">=</span>8 /var/mogdata/<span class="o">{</span>new-dev<span class="o">}</span> /dev/sdb
</span><span class='line'>
</span><span class='line'><span class="c">#增加到fstab</span>
</span><span class='line'>vim /etc/fstab
</span><span class='line'>/dev/sdb     /var/mogdata/<span class="o">{</span>new-dev<span class="o">}</span>    xfs    noatime,noikeep,logbufs<span class="o">=</span>8    0 0
</span></code></pre></td></tr></table></div></figure>


<p>3.配置nginx</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>chown -R mogile.daemon /var/mogdata/<span class="o">{</span>new-dev<span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c">#建议注释掉损坏的location</span>
</span><span class='line'>vim /etc/nginx/conf.d/<span class="o">{</span>xxx.conf<span class="o">}</span>
</span><span class='line'>
</span><span class='line'>location /<span class="o">{</span>new-dev<span class="o">}</span>/ <span class="o">{</span>
</span><span class='line'>    expires             max;
</span><span class='line'>    root                /var/mogdata;
</span><span class='line'>    client_max_body_size        20m;
</span><span class='line'>    client_body_temp_path       /var/mogdata/<span class="o">{</span>new-dev<span class="o">}</span>/temp;
</span><span class='line'>    dav_methods                 PUT DELETE MKCOL;
</span><span class='line'>    create_full_put_path        on;
</span><span class='line'>    dav_access                  user:rw group:r all:r;
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>/etc/init.d/nginx reload
</span></code></pre></td></tr></table></div></figure>


<p>4.增加一个新设备</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mogadm device add &lt;hostname&gt; &lt;devid&gt; <span class="o">[</span>opts<span class="o">]</span>        Add a device to a host.
</span><span class='line'>
</span><span class='line'>      &lt;devid&gt;              Numeric devid.  Never reuse these.
</span><span class='line'>      &lt;hostname&gt;           Hostname to add a device
</span><span class='line'>      --status<span class="o">=</span>s           One of <span class="s1">&#39;alive&#39;</span> or <span class="s1">&#39;down&#39;</span>.  Defaults to <span class="s1">&#39;alive&#39;</span>.
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[inotify,rsync统一化配置]]></title>
    <link href="http://www.wanghd.com/blog/2012/11/25/inotify/"/>
    <updated>2012-11-25T16:14:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2012/11/25/inotify</id>
    <content type="html"><![CDATA[<h3>为什么要统一化配置，手动改改不行？</h3>

<ul>
<li>假设有10台服务器，要改10次，错误和遗漏在所难免</li>
<li>需要有一个地方备份配置</li>
<li>也许还需要对配置文件进行版本控制</li>
</ul>


<h3>inotify+rsync改变这一切</h3>

<ul>
<li>inotify可以递归的监控文件是否有新建，修改等</li>
<li>rsync用来同步</li>
</ul>


<!-- more -->


<h3>安装inotify</h3>

<ul>
<li>内核版本要Linux 2.6.13以上</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget --no-check-certificate https://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz
</span><span class='line'>tar -zxvf inotify-tools-3.14.tar.gz
</span><span class='line'><span class="nb">cd </span>inotify-tools-3.14
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<h3>测试脚本监控修改并自动同步</h3>

<ul>
<li>&#8211;exclude是用来排除隐藏文件</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="nv">ip</span><span class="o">=</span><span class="s2">&quot;192.168.30.1 192.168.30.2&quot;</span>
</span><span class='line'><span class="nv">src</span><span class="o">=</span><span class="s2">&quot;/tmp/test&quot;</span>
</span><span class='line'>inotifywait --exclude <span class="s1">&#39;/\.&#39;</span> -mrq -e close_write,delete,move <span class="nv">$src</span> | <span class="k">while </span><span class="nb">read </span>line
</span><span class='line'><span class="k">do</span>
</span><span class='line'><span class="k">    </span>sleep 1
</span><span class='line'>    <span class="nb">echo</span> <span class="nv">$line</span>
</span><span class='line'>    <span class="k">for </span>i in <span class="nv">$ip</span>
</span><span class='line'>    <span class="k">do </span>
</span><span class='line'><span class="k">        </span>rsync --exclude<span class="o">=</span><span class="s2">&quot;.*&quot;</span> -av --delete-after <span class="s2">&quot;$src/&quot;</span> -e ssh <span class="s2">&quot;$i:$src/&quot;</span>
</span><span class='line'>    <span class="k">done</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MogileFS安装配置]]></title>
    <link href="http://www.wanghd.com/blog/2012/11/22/mogilefsan-zhuang-pei-zhi/"/>
    <updated>2012-11-22T17:19:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2012/11/22/mogilefsan-zhuang-pei-zhi</id>
    <content type="html"><![CDATA[<h3>基本介绍</h3>

<ul>
<li>mogilefs是一个分布式的文件系统解决方案</li>
<li>特点是:无单点失效的问题，自动复制无需raid，easy的命名空间，自修复机制，成熟的管理工具，源码清晰推荐阅读</li>
</ul>


<!-- more -->


<h3>安装基本组件</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum groupinstall <span class="s2">&quot;Development Tools&quot;</span>
</span><span class='line'><span class="c">#cpan是perl的包管理工具</span>
</span><span class='line'>yum install cpan
</span></code></pre></td></tr></table></div></figure>


<h3>安装mogilefs</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#进入cpan,初始化直接自动就好</span>
</span><span class='line'>cpan
</span><span class='line'>&gt; install IO::AIO
</span><span class='line'>&gt; install MogileFS::Client
</span><span class='line'>&gt; install MogileFS::Utils
</span><span class='line'><span class="c">#如果有问题直接用force install</span>
</span><span class='line'>&gt; install MogileFS::Server
</span></code></pre></td></tr></table></div></figure>


<h3>安装配置mysql</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#安装mysql</span>
</span><span class='line'>yum install mysql mysql-server
</span><span class='line'>mysqladmin -u root password 123456
</span><span class='line'><span class="c">#进入mysql,新建mogile用户</span>
</span><span class='line'>mysql -uroot -p123456
</span><span class='line'>mysql&gt; create database mogilefs;
</span><span class='line'>mysql&gt; grant all on mogilefs.* to mogile@localhost identified by <span class="s1">&#39;123456&#39;</span>;
</span><span class='line'>mysql&gt; flush privileges;
</span><span class='line'>
</span><span class='line'><span class="c">#导入mogilefs表</span>
</span><span class='line'>mogdbsetup --dbpass<span class="o">=</span>123456 --yes
</span></code></pre></td></tr></table></div></figure>


<h3>mogilefs配置</h3>

<ul>
<li>mogilefsd配置</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#/etc/mogilefs是默认的配置路径，-c可以修改</span>
</span><span class='line'>mkdir -p /etc/mogilefs
</span><span class='line'><span class="nb">cd</span> /etc/mogilefs
</span><span class='line'>vim mogilefsd.conf
</span><span class='line'>
</span><span class='line'><span class="c">#内容如下</span>
</span><span class='line'><span class="nv">pidfile</span> <span class="o">=</span> /tmp/mogilefsd.pid    <span class="c">#存放pid</span>
</span><span class='line'><span class="nv">daemonize</span> <span class="o">=</span> 1                   <span class="c">#守护进程</span>
</span><span class='line'>
</span><span class='line'><span class="nv">db_dsn</span>  <span class="o">=</span> DBI:mysql:mogilefs:127.0.0.1  <span class="c">#数据库配置</span>
</span><span class='line'><span class="nv">db_user</span> <span class="o">=</span> mogile
</span><span class='line'><span class="nv">db_pass</span> <span class="o">=</span> 123456
</span><span class='line'>
</span><span class='line'><span class="nv">conf_port</span> <span class="o">=</span> 7001                <span class="c">#监听端口</span>
</span><span class='line'><span class="nv">node_timeout</span> <span class="o">=</span> 2                <span class="c">#节点超时时间 </span>
</span><span class='line'><span class="nv">rebalance_ignore_missing</span> <span class="o">=</span> 1    <span class="c">#rebalance时会删除文件，删除时如果找不到文件不报错直接跳过 </span>
</span><span class='line'>
</span><span class='line'><span class="nv">query_jobs</span> <span class="o">=</span> 20                 <span class="c">#正真处理请求的job个数</span>
</span><span class='line'><span class="nv">delete_jobs</span> <span class="o">=</span> 3                 <span class="c">#处理删除队列的job个数</span>
</span><span class='line'><span class="nv">replicate_jobs</span> <span class="o">=</span> 5              <span class="c">#处理复制队列的job个数</span>
</span><span class='line'><span class="nv">reaper_jobs</span> <span class="o">=</span> 1                 <span class="c">#设备设置为dead后，处理补救工作的job个数 </span>
</span><span class='line'>                                <span class="c">#其实还有其他job，默认为1个</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>mogstored配置</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#设置文件存储路径，不要忘记修改拥有者</span>
</span><span class='line'>mkdir -p /var/mogdata
</span><span class='line'>adduser --gid daemon mogile
</span><span class='line'>chown mogile.daemon /var/mogdata
</span><span class='line'>vim mogstored.conf
</span><span class='line'>
</span><span class='line'><span class="c">#内容如下</span>
</span><span class='line'><span class="nv">httplisten</span> <span class="o">=</span> 0.0.0.0:7500       <span class="c">#文件存储端口</span>
</span><span class='line'><span class="nv">mgmtlisten</span> <span class="o">=</span> 0.0.0.0:7501       <span class="c">#监控磁盘状态端口</span>
</span><span class='line'><span class="nv">docroot</span> <span class="o">=</span> /var/mogdata          <span class="c">#文件存储路径</span>
</span><span class='line'>
</span><span class='line'><span class="nv">pidfile</span> <span class="o">=</span> /tmp/mogstored.pid    <span class="c">#存储pid</span>
</span><span class='line'><span class="nv">daemonize</span> <span class="o">=</span> 1                   <span class="c">#守护进程</span>
</span></code></pre></td></tr></table></div></figure>


<h3>启动mogilefs</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>vim /etc/security/limits.conf
</span><span class='line'><span class="c">#内容如下，让mogile可以打开更多的连接数</span>
</span><span class='line'>mogile soft nofile 65535
</span><span class='line'>mogile hard nofile 65535
</span><span class='line'>
</span><span class='line'><span class="c">#切换用户启动</span>
</span><span class='line'>su mogile -c <span class="s1">&#39;mogstored&#39;</span>
</span><span class='line'>su mogile -c <span class="s1">&#39;mogilefsd&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c">#验证已经启动成功</span>
</span><span class='line'>ps auxf | grep mogile
</span><span class='line'>mogadm check
</span></code></pre></td></tr></table></div></figure>


<h3>已经安装好了，接来应该做点什么呢</h3>

<ul>
<li>学习mogadm指令，因为mogadm是必会工具</li>
<li>试着client连接mogilefsd存储文件吧</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Time::HiRes介绍]]></title>
    <link href="http://www.wanghd.com/blog/2012/11/22/time-hiresjie-shao/"/>
    <updated>2012-11-22T17:18:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2012/11/22/time-hiresjie-shao</id>
    <content type="html"><![CDATA[<h3>Time::HiRes库介绍</h3>

<ul>
<li>HiRes是high resolution的简写，译为高分辨率</li>
<li>HiRes其实是提供一些更高精度的alarm, sleep, gettimeofday, interval timers</li>
</ul>


<!-- more -->


<h3>usleep，nanosleep实例</h3>

<ul>
<li>usleep参数是微妙</li>
<li>nanosleep参数是纳秒</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="nn">Time::HiRes::</span><span class="n">usleep</span><span class="p">(</span><span class="mi">100_000</span><span class="p">);</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;100 milliseconds\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nn">Time::HiRes::</span><span class="n">nanosleep</span><span class="p">(</span><span class="mi">1000_000_000</span><span class="p">);</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;1 seconds\n&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ualarm实例</h3>

<ul>
<li>ualarm(0)会撤销警告信号</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="nb">eval</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">local</span> <span class="nv">$SIG</span><span class="p">{</span><span class="n">ALRM</span><span class="p">}</span> <span class="o">=</span> <span class="k">sub </span><span class="p">{</span> <span class="nb">die</span> <span class="s">&quot;receive signal\n&quot;</span> <span class="p">};</span>
</span><span class='line'>    <span class="nn">Time::HiRes::</span><span class="n">ualarm</span> <span class="mi">1000_000</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">sleep</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;never print&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="vg">$@</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">print</span> <span class="vg">$@</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nb">eval</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">local</span> <span class="nv">$SIG</span><span class="p">{</span><span class="n">ALRM</span><span class="p">}</span> <span class="o">=</span> <span class="k">sub </span><span class="p">{</span> <span class="nb">die</span> <span class="s">&quot;receive signal\n&quot;</span> <span class="p">};</span>
</span><span class='line'>    <span class="nn">Time::HiRes::</span><span class="n">ualarm</span> <span class="mi">2000_000</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">sleep</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="nn">Time::HiRes::</span><span class="n">ualarm</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">#cancel alarm</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="vg">$@</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">print</span> <span class="vg">$@</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;cancel alarm signal\n&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>tv_interval和gettimeofday实例</h3>

<ul>
<li>tv_interval返回两个gettimeofday引用相差的秒数</li>
<li>省略tv_interval的第二个参数，会自动使用当前时间代替</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">my</span> <span class="nv">@start</span> <span class="o">=</span> <span class="nn">Time::HiRes::</span><span class="n">gettimeofday</span><span class="p">;</span>
</span><span class='line'><span class="k">print</span> <span class="n">Dumper</span><span class="p">(</span><span class="o">\</span><span class="nv">@start</span><span class="p">);</span>
</span><span class='line'><span class="nb">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'><span class="k">my</span> <span class="nv">$diff</span> <span class="o">=</span> <span class="nn">Time::HiRes::</span><span class="n">tv_interval</span><span class="p">(</span><span class="o">\</span><span class="nv">@start</span><span class="p">);</span>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;$diff\n&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>setitimer实例</h3>

<ol>
<li>ITIMER_REAL: 真实时间</li>
<li>ITIMER_VIRTUAL: 用户时间</li>
<li><p>ITIMER_PROF: 系统时间</p></li>
<li><p>getitimer可以取得setitimer还有多久开始执行</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="k">use</span> <span class="nn">Time::</span><span class="n">HiRes</span> <span class="sx">qw ( </span><span class="n">setitimer</span> <span class="n">ITIMER_VIRTUAL</span> <span class="nb">time</span> <span class="p">);</span>
</span><span class='line'><span class="nv">$SIG</span><span class="p">{</span><span class="n">VTALRM</span><span class="p">}</span> <span class="o">=</span> <span class="k">sub </span><span class="p">{</span> <span class="k">print</span> <span class="nb">time</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span> <span class="p">};</span>
</span><span class='line'><span class="n">setitimer</span><span class="p">(</span><span class="n">ITIMER_VIRTUAL</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mongodb实战]]></title>
    <link href="http://www.wanghd.com/blog/2012/11/22/mongodbshi-zhan/"/>
    <updated>2012-11-22T17:18:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2012/11/22/mongodbshi-zhan</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
</feed>
