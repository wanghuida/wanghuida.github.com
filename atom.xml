<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[老虎的眼睛]]></title>
  <link href="http://www.wanghd.com/atom.xml" rel="self"/>
  <link href="http://www.wanghd.com/"/>
  <updated>2013-07-02T13:40:08+08:00</updated>
  <id>http://www.wanghd.com/</id>
  <author>
    <name><![CDATA[王惠达 huida wanghuida]]></name>
    <email><![CDATA[wanghuida258@yahoo.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[php图片处理ubuntu配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/07/02/phptu-pian-chu-li-ubuntupei-zhi/"/>
    <updated>2013-07-02T10:08:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/07/02/phptu-pian-chu-li-ubuntupei-zhi</id>
    <content type="html"><![CDATA[<ul>
<li>安装imagemagick 和图片库</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install libpng12-0 libpng12-dev libpng3
</span><span class='line'>sudo apt-get install libtiff4 libtiff4-dev libtiffxx0c2
</span><span class='line'>sudo apt-get install libjasper-dev libjpeg-dev
</span><span class='line'>sudo apt-get install imagemagick
</span><span class='line'>
</span><span class='line'># 显示 imagemagick 支持的图片类型 
</span><span class='line'>convert -list format
</span><span class='line'>convert -list configure</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>安装 php和php模块</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install php5 php5-curl php5-gd php5-mysql php5-fpm php5-imagick php5-xcache php5-cli php5-common php5-mcrypt</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置xcache</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xcache.size  =  64M
</span><span class='line'>xcache.count =  8
</span><span class='line'>xcache.slots =  16K</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置fpm里的php.ini</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>error_log = /tmp/php-error.log
</span><span class='line'>post_max_size = 20M
</span><span class='line'>upload_max_filesize = 20M
</span><span class='line'>date.timezone = PRC</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置fpm</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user = ***
</span><span class='line'>group = ***
</span><span class='line'>listen = 127.0.0.1:10001
</span><span class='line'>pm.max_children = 16</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装配置nginx请参考<a href="http://www.wanghd.com/blog/2013/03/31/nginx-pei-zhi-mo-ban/">这篇文章</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[浮动居中]]></title>
    <link href="http://www.wanghd.com/blog/2013/06/27/fu-dong-ju-zhong/"/>
    <updated>2013-06-27T10:52:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/06/27/fu-dong-ju-zhong</id>
    <content type="html"><![CDATA[<ul>
<li><p>对于定宽的非浮动元素我们可以用 margin:0 auto; 进行水平居中，对于不定宽的浮动元素我们也有一个常用的技巧解决它的水平居中问题。分解如下：</p></li>
<li><p>HTML 部分：</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="test"&gt;
</span><span class='line'>    &lt;p&gt;浮动的&lt;/p&gt;
</span><span class='line'>    &lt;p&gt;居中的&lt;/p&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>CSS 部分：</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.test{
</span><span class='line'>    float:left;
</span><span class='line'>    position:relative;
</span><span class='line'>    left:50%;
</span><span class='line'>}
</span><span class='line'>p{
</span><span class='line'>    float:left;
</span><span class='line'>    position:relative;
</span><span class='line'>    right:50%;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<ul>
<li>这样看来就很简单了吧，父元素和子元素同时左浮动，然后父元素相对左移动50%，再然后子元素相对右移动50%，或者子元素相对左移动-50%也就可以了。如此简单如此神奇。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sshfs]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/30/sshfs/"/>
    <updated>2013-05-30T16:57:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/30/sshfs</id>
    <content type="html"><![CDATA[<ul>
<li>今天看到sshfs可以像mount一样挂上磁盘非常方便记录一下</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>sshfs user@hostname:path mount_point
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cacti spine的安装配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/29/cacti-spinede-an-zhuang-pei-zhi/"/>
    <updated>2013-05-29T15:35:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/29/cacti-spinede-an-zhuang-pei-zhi</id>
    <content type="html"><![CDATA[<ul>
<li>cacti官方有详细的配置流程，这里只是翻译和错误的解决</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://www.cacti.net/downloads/spine/cacti-spine-0.8.8a.tar.gz
</span><span class='line'>tar -zxvf cacti-spine-0.8.8a.tar.gz
</span><span class='line'><span class="nb">cd </span>cacti-spine-0.8.8a/
</span><span class='line'>
</span><span class='line'>./configure
</span><span class='line'><span class="c"># configure: error: Cannot find MySQL headers.  Use --with-mysql= to specify non-default path.</span>
</span><span class='line'><span class="c"># 下载安装mysqlclient开发包</span>
</span><span class='line'>sudo apt-get install libmysqlclient-dev
</span><span class='line'>
</span><span class='line'>./configure
</span><span class='line'><span class="c"># configure: error: Cannot find SNMP headers.  Use --with-snmp= to specify non-default path.</span>
</span><span class='line'><span class="c"># 下载安装snmp开发包</span>
</span><span class='line'>sudo apt-cache search snmp | grep dev
</span><span class='line'>sudo apt-get install libsnmp-dev
</span><span class='line'>
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>搞定配置文件</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cp /usr/local/spine/etc/spine.conf.dist /usr/local/spine/etc/spine.conf
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>admin登录cacti页面, 选择Settings的Paths选项卡，输入完整的spine路径[Alternate Poller Path]</p></li>
<li><p>点击Settings的Poller选项卡，从Poller Type里选择spine</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解决 sysDescr: Unknown Object Identifier (Sub-id not found: (top)  sysDescr)]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/29/sysdescr-unknown-object-identifier-sub-id-not-found-top-sysdescr/"/>
    <updated>2013-05-29T11:58:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/29/sysdescr-unknown-object-identifier-sub-id-not-found-top-sysdescr</id>
    <content type="html"><![CDATA[<ul>
<li>ubuntu安装snmp很方便</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install snmp snmpd</span></code></pre></td></tr></table></div></figure>


<ul>
<li>配置我就跳过了，直接测试，问题来了</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>snmpwalk -v 2c -c public 127.0.0.1 sysDescr
</span><span class='line'>
</span><span class='line'># 显示 sysDescr: Unknown Object Identifier (Sub-id not found: (top) -&gt; sysDescr)</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>网上搜一下，没有正确可行的办法，但是也是有收获</p></li>
<li><p>直接使用snmpwalk -v 2c -c public 127.0.0.1 是没有问题的</p></li>
<li>那就说明问题出在mibs上</li>
<li>尝试解决一下</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install snmp-mibs-downloader
</span><span class='line'>
</span><span class='line'>vim /etc/snmp/snmp.conf
</span><span class='line'>#全部注释下～～～
</span><span class='line'>#再测试就没问题了，使用了新的mibs
</span><span class='line'>snmpwalk -v 2c -c public 127.0.0.1 sysDescr
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sqlalchemy 定义模型]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/24/sqlalchemy-ding-yi-mo-xing/"/>
    <updated>2013-05-24T17:04:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/24/sqlalchemy-ding-yi-mo-xing</id>
    <content type="html"><![CDATA[<ol>
<li>下面是一个基本的模型，对应db的一张表</li>
<li>nullable 代表是否可以为空</li>
<li>server_default 代表默认值</li>
<li>常用类型：Integer, String, DateTime, TIMESTAMP, DECIMAL</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># coding: utf-8</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy.sql.expression</span> <span class="kn">import</span> <span class="n">text</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">DECIMAL</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
</span><span class='line'><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Member</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
</span><span class='line'>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">&#39;tbl_member&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ext_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
</span><span class='line'>    <span class="n">username</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="n">my_desc</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">createtime</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'>    <span class="n">modifytime</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">text</span><span class="p">(</span><span class="s">&#39;CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#39;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[yii 隐藏index.php RESTful nginx配置]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/24/yii-yin-cang-index-dot-php/"/>
    <updated>2013-05-24T14:36:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/24/yii-yin-cang-index-dot-php</id>
    <content type="html"><![CDATA[<ol>
<li>默认yii不使用RESTful的url，比如: index.php/news/list?category=12</li>
<li><p>通过简单的配置可以美化url，比如：/news/list/category/12</p></li>
<li><p>修改main.php配置</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;urlManager&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;urlFormat&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;path&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;showScriptName&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;rules&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>修改nginx.php配置</li>
</ul>


<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">server {</span>
</span><span class='line'><span class="x">    listen          11111;</span>
</span><span class='line'><span class="x">    index           index-test.php index.html;</span>
</span><span class='line'><span class="x">    root            /xxxxxx/xxxxx/project/yii-test;</span>
</span><span class='line'><span class="x">    charset         utf-8;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    client_max_body_size 20m;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    # 是否存在文件，不存在就rewrite index-test.php，生产应该是index.php</span>
</span><span class='line'><span class="x">    location / {</span>
</span><span class='line'><span class="x">        if (!-e $request_filename){</span>
</span><span class='line'><span class="x">            rewrite ^/(.*) /index-test.php last;</span>
</span><span class='line'><span class="x">        }</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'>
</span><span class='line'><span class="x">    # 缓存资源文件</span>
</span><span class='line'><span class="x">    location ~* \.(js|css|png|jpg|jpeg|gif|ico|swf)$ {</span>
</span><span class='line'><span class="x">        expires 24h;</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'>
</span><span class='line'><span class="x">    # 定义path_info，并交给fpm处理</span>
</span><span class='line'><span class="x">    location ~ \.php {</span>
</span><span class='line'><span class="x">        fastcgi_split_path_info     ^(.+\.php)(/.*)$;</span>
</span><span class='line'><span class="x">        fastcgi_param               PATH_INFO                               $fastcgi_script_name;</span>
</span><span class='line'><span class="x">        include                     /usr/local/etc/nginx/fastcgi.conf;</span>
</span><span class='line'><span class="x">        fastcgi_pass                127.0.0.1:10001;</span>
</span><span class='line'><span class="x">        fastcgi_index               index-test.php;</span>
</span><span class='line'><span class="x">        expires                     off;</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[yii 用户验证]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/24/yii-yong-hu-yan-zheng/"/>
    <updated>2013-05-24T12:39:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/24/yii-yong-hu-yan-zheng</id>
    <content type="html"><![CDATA[<ol>
<li>yii用户验证其实很简单，但是网络上的文章都写的不够详细【包括官方的】</li>
<li>先介绍一下基于session的用户验证</li>
<li>用cookie让用户可以保持状态，再介绍一下安全性</li>
</ol>


<!-- more -->


<ul>
<li>main.php 配置登录页面</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;loginUrl&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>在控制器中增加权限控制和规则</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">CController</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1"># 让控制器加入到权限控制</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">filters</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="s1">&#39;accessControl&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># 让edit,view这2个action访客无法直接使用，跳转到登录界面</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">accessRules</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;deny&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="s1">&#39;actions&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">,</span> <span class="s1">&#39;view&#39;</span><span class="p">),</span>
</span><span class='line'>                <span class="s1">&#39;users&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionEdit</span><span class="p">()</span> <span class="p">{</span> <span class="nb">var_dump</span><span class="p">(</span><span class="s1">&#39;edit&#39;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionView</span><span class="p">()</span> <span class="p">{</span> <span class="nb">var_dump</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>创建继承CUserIdentity的用户标识类给登录时使用</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">UserIdentity</span> <span class="k">extends</span> <span class="nx">CUserIdentity</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_id</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">authenticate</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">            这里可以写判断是否有用户的逻辑</span>
</span><span class='line'>
</span><span class='line'><span class="cm">            需要存储到session里的数据可以这样写</span>
</span><span class='line'><span class="cm">            $this-&gt;setState(&#39;nickname&#39;, $member-&gt;nickname);</span>
</span><span class='line'><span class="cm">        */</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_id</span> <span class="o">=</span> <span class="nv">$member</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_id</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>用户登陆的控制器</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$req</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$user</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionLogin</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$reason</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span><span class="o">-&gt;</span><span class="na">isPostRequest</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$password</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">req</span><span class="o">-&gt;</span><span class="na">getPost</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="nv">$identity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserIdentity</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$identity</span><span class="o">-&gt;</span><span class="na">authenticate</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$identity</span><span class="p">);</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">returnUrl</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$reason</span> <span class="o">=</span> <span class="nv">$identity</span><span class="o">-&gt;</span><span class="na">errorMessage</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="o">=&gt;</span><span class="nv">$reason</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<hr />


<ul>
<li>增加登录cookie保持用户登录状态，改完赶紧尝试一下吧</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># 修改main.php,允许自动登录</span>
</span><span class='line'><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;allowAutoLogin&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;loginUrl&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;user/login&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">),</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 修改UserController设置7天有效期</span>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$identity</span><span class="p">,</span> <span class="mi">86400</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>不经问自己：这样的cookie安全吗？会不会被利用？</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">1. 不应该把敏感信息保存到state里，比如密码</span>
</span><span class='line'><span class="x">2. yii内部有cookie校验机制，改动的cookie是无法生效的，可以看下/protected/runtime/state.bin（这就是验证随机的key）</span>
</span><span class='line'><span class="x">3. 想要知道yii内部生成key源码可以参考 CSecurityManager</span>
</span><span class='line'>
</span><span class='line'><span class="x">protected function generateRandomKey()</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    return sprintf(&#39;%08x%08x%08x%08x&#39;,mt_rand(),mt_rand(),mt_rand(),mt_rand());</span>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[yii 文件日志]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/23/yii-ri-zhi/"/>
    <updated>2013-05-23T15:12:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/23/yii-ri-zhi</id>
    <content type="html"><![CDATA[<ul>
<li>yii的文件日志默认在runtime下的application.log</li>
</ul>


<!-- more -->


<ul>
<li>yii配置文件日志和记录等级</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="c1"># main.php配置文件, 生产环境只记录error和warning</span>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;log&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CLogRouter&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;routes&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span>
</span><span class='line'>                <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CFileLogRoute&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="s1">&#39;levels&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;error, warning&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># test.php配置文件，线下测试所有的都记录下来</span>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;log&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CLogRouter&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;routes&#39;</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span>
</span><span class='line'>                <span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;CFileLogRoute&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="c1">#trace内容很多，一般不开启，用info足够了</span>
</span><span class='line'>                <span class="s1">&#39;levels&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;info, profile, error, warning&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 记录日志, 1.log信息,2.等级,3.分类（分类自定义）</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;info调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_INFO</span><span class="p">,</span> <span class="s1">&#39;test.info&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;profile调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_PROFILE</span><span class="p">,</span> <span class="s1">&#39;test.profile&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;warning调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_WARNING</span><span class="p">,</span> <span class="s1">&#39;test.warning&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">Yii</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">&#39;error调试信息&#39;</span><span class="p">,</span> <span class="nx">CLogger</span><span class="o">::</span><span class="na">LEVEL_ERROR</span><span class="p">,</span> <span class="s1">&#39;test.error&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>服务器异常错误，显示错误页面，这样的错误会记录到日志中（因为属于error, warning）</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="c1"># 在main.php中配置errorHandler，统一处理异常</span>
</span><span class='line'><span class="s1">&#39;components&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>    <span class="s1">&#39;errorHandler&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>        <span class="s1">&#39;errorAction&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;site/error&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 在Site控制器里增加error的action，处理错误</span>
</span><span class='line'><span class="k">class</span> <span class="nc">SiteController</span> <span class="k">extends</span> <span class="nx">Controller</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionIndex</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1"># 产生一个异常</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nx">CHttpException</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;调用接口失败&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionError</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$error</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="na">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">errorHandler</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$error</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">];</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$params</span><span class="p">[</span><span class="s1">&#39;is_debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">YII_DEBUG</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;/error&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jquery validation]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/23/jquery-validation/"/>
    <updated>2013-05-23T12:41:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/23/jquery-validation</id>
    <content type="html"><![CDATA[<h3>表单验证在网站开发中是肯定有的，还好jquery在这方面已经做的很好了</h3>

<ul>
<li>自定义一种验证类型</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">jQuery</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span>
</span><span class='line'>    <span class="s2">&quot;cellphone&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">optional</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">||</span> <span class="sr">/^1\d{10}$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s2">&quot;请输入有效的手机号码&quot;</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>定义规则和错误显示</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form&#39;</span><span class="p">).</span><span class="nx">validate</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">nickname</span><span class="o">:</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">email</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">email</span><span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">password</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">minlength</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">messages</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">nickname</span><span class="o">:</span> <span class="s2">&quot;请输入昵称&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">email</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="s2">&quot;请输入邮箱&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">email</span><span class="o">:</span> <span class="s2">&quot;请输入有效的邮箱&quot;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">password</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">required</span><span class="o">:</span> <span class="s2">&quot;请输入密码&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">minlength</span><span class="o">:</span> <span class="s2">&quot;密码的长度不能小于6位&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">errorElement</span><span class="o">:</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">wrapper</span><span class="o">:</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">errorPlacement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">element</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">after</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">highlight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">errorClass</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border&#39;</span><span class="p">,</span> <span class="s1">&#39;1px solid red&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">unhighlight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">errorClass</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;border&#39;</span><span class="p">,</span> <span class="s1">&#39;1px solid #777&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">submitHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Submitted!&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[英文Ubuntu安装中文包]]></title>
    <link href="http://www.wanghd.com/blog/2013/05/02/ying-wen-ubuntuan-zhuang-zhong-wen-bao/"/>
    <updated>2013-05-02T18:07:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/05/02/ying-wen-ubuntuan-zhuang-zhong-wen-bao</id>
    <content type="html"><![CDATA[<h3>查看系统内安装的locale：</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>locale -a
</span><span class='line'># 如果没有“zh-CN.UTF-8”，则表示系统内没有安装中文locale。这会导致“LC_CTYPE: cannot change locale (zh_CN.UTF-8)”的警告。</span></code></pre></td></tr></table></div></figure>


<h3>输入以下命令安装：</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /usr/share/locales 
</span><span class='line'>sudo ./install-language-pack zh_CN</span></code></pre></td></tr></table></div></figure>


<ul>
<li>然后重开终端，就可以发现中文locale已经安装完毕，警告已经不再出现了。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[主从切换]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/07/zhu-cong-qie-huan/"/>
    <updated>2013-04-07T20:32:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/07/zhu-cong-qie-huan</id>
    <content type="html"><![CDATA[<h3>1个master，1个slave1，1个slave2，关闭master，让slave1做master，slave2同步新master</h3>

<ul>
<li>slave1开启同步账号</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; grant replication slave on *.* to 'backup'@'192.168.0.152' identified by '123456';
</span><span class='line'>mysql &gt; grant replication slave on *.* to 'backup'@'192.168.0.153' identified by '123456';
</span><span class='line'>mysql &gt; flush privileges;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>锁住master的写</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; flush tables with read lock;
</span><span class='line'>
</span><span class='line'># 关闭锁的命令：unlock tables;</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>查看slave1和slave2的同步状态</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; show processlist;
</span><span class='line'>
</span><span class='line'># 确保 Slave has read all relay log; waiting for the slave I/O thread to update it</span></code></pre></td></tr></table></div></figure>


<ul>
<li>修改slave1的配置，并重启</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bind-address = 0.0.0.0
</span><span class='line'>
</span><span class='line'>$ sudo service mysql restart</span></code></pre></td></tr></table></div></figure>


<ul>
<li>停止slave1的slave，设置为master</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; stop slave;
</span><span class='line'>mysql &gt; reset master;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>停止slave2的slave，重新设置master</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; stop slave;
</span><span class='line'>
</span><span class='line'>mysql &gt; change master to
</span><span class='line'>      &gt; master_host = '192.168.0.151',
</span><span class='line'>      &gt; master_user = 'backup',
</span><span class='line'>      &gt; master_password = '123456';
</span><span class='line'>
</span><span class='line'>mysql&gt; start slave;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>测试是否成功</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql &gt; create table `test` ( id int not null auto_increment, `name` varchar(100) not null, primary key (`id`) );
</span><span class='line'>mysql &gt; drop table test;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[克隆 slave]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/07/ke-long-slave/"/>
    <updated>2013-04-07T17:54:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/07/ke-long-slave</id>
    <content type="html"><![CDATA[<h3>已经有一台master 和 一台slave1，从slave1上克隆一个slave2</h3>

<ul>
<li>关闭slave1 的 io_thread，那么slave1就不会读取master的bin-log了，也不会写自己的relay-log了</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; stop slave io_thread</span></code></pre></td></tr></table></div></figure>


<ul>
<li>查看slave1 的 processlist，确保sql_thread在等待io_thread</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; show processlist\G;
</span><span class='line'>
</span><span class='line'># 显示如下结果，可以继续操作
</span><span class='line'>State: Slave has read all relay log; waiting for the slave I/O thread to update it</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>停止slave1的slave, 导出数据，并复制数据到slave2【如果数据大可以压缩】</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; stop slave
</span><span class='line'>
</span><span class='line'>$ mysqldump -uroot -p mmd &gt; mmd.sql
</span><span class='line'>
</span><span class='line'>$ scp mmd.sql wanghuida@192.168.100.100:mmd.sql</span></code></pre></td></tr></table></div></figure>


<ul>
<li>slave2 创建数据库，并导入数据</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mysqladmin -uroot -p create mmd
</span><span class='line'>$ mysql -uroot -p mmd &lt; mmd.sql</span></code></pre></td></tr></table></div></figure>


<ul>
<li>修改 slave2 配置， 并重启</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/mysql/my.cnf
</span><span class='line'>
</span><span class='line'>server-id       = 3
</span><span class='line'>log_bin         = /var/log/mysql/mysql-bin.log
</span><span class='line'>expire_logs_days    = 10
</span><span class='line'>max_binlog_size     = 100M
</span><span class='line'>replicate-do-db     = mmd
</span><span class='line'>read_only           = 1
</span><span class='line'>
</span><span class='line'>$ /etc/init.d/mysqld restart
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>查看slave1上的从状态</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; show slave status\G;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>设置slave2 的主从同步配置，再启动就可以了</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; change master to 
</span><span class='line'>    master_host = '192.168.100.153', 
</span><span class='line'>    master_user = 'backup', 
</span><span class='line'>    master_password = '123456', 
</span><span class='line'>    master_log_file = 'mysql-bin.000016', 
</span><span class='line'>    master_log_pos = 115910;
</span><span class='line'>
</span><span class='line'>mysql&gt; start slave</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[5分钟理解iptables]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/04/5fen-zhong-li-jie-iptables/"/>
    <updated>2013-04-04T10:08:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/04/5fen-zhong-li-jie-iptables</id>
    <content type="html"><![CDATA[<h3>iptables作用</h3>

<ol>
<li>过滤请求，根据条件决定通过或拒绝</li>
<li>网络地址转换</li>
<li>修改头信息</li>
</ol>


<h3>iptables的组成部分</h3>

<ul>
<li>table：根据类型分了3种，分别是filter,nat,mangle。filter用来过滤，nat用来地址转换，mangle用来改ttl之类的头信息【不常用】。</li>
<li>chain：是指网络包处理的某个阶段，看下图：1.yes这条路线目的地址是本机。2.no这条路线目的地址是其他网段，需要转发。</li>
</ul>


<p><img src="http://www.wanghd.com/images/post/iptables.gif" title="iptables" alt="iptables" /></p>

<!-- more -->


<ul>
<li>rule：用来判断哪些包需要处理，例如-p指定协议，-s指定源地址，-d指定目的地址，-i和-o定义输入输出的设备</li>
<li>target：其实用target这个词很不好理解，我的理解是符合规则后的操作</li>
</ul>


<h3>iptables命令的语法</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo iptables [table] [chain] [rule] [target]
</span><span class='line'># table用-t表示，例如-t nat，-t fileter。如果不加-t 默认就是filter
</span><span class='line'># chain前面需要加一个动词，例如-A INPUT意思是"添加 input链"，例如-I POSTROUTING 2意思是"插入 postrouting 到第二条记录"
</span><span class='line'># rule上面已经解释过了
</span><span class='line'># target可以是ACCEPT，DROP，SNAT，MASQUERADE等，代表满足规则的话，就执行这种操作</span></code></pre></td></tr></table></div></figure>


<h3>记录一些例子，并解释</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 清空nat表里的记录
</span><span class='line'>sudo iptables -F -t nat
</span><span class='line'># 在filter表里增加一条都接收的记录 
</span><span class='line'>sudo iptables -t filter -A INPUT -j ACCEPT
</span><span class='line'># 更改从eth1出去的源地址为114.77.99.212，一般用在共享单个ip
</span><span class='line'>sudo iptables -t nat -A POSTROUTING -o eth1 -j SNAT --to-source 114.77.99.212</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu route命令]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/03/ubuntu-routeming-ling/"/>
    <updated>2013-04-03T18:55:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/03/ubuntu-routeming-ling</id>
    <content type="html"><![CDATA[<h3>route是非常常用的命令，作用是增加一条静态路由</h3>

<ul>
<li>以前觉得这条命令很难用，其实很简单～～</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># route 直接打印静态路由表 -n 选项代表把域名解析成ip
</span><span class='line'>$ route -n</span></code></pre></td></tr></table></div></figure>


<h3>route 命令的基本格式</h3>

<ul>
<li>route 操作 目标地址 网关 设备</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 例1: eth0发往192.168.0.0网段的数据，都交给192.168.0.1网关
</span><span class='line'># add就是操作，-net 192.168.0.0/24 就是目标网段
</span><span class='line'># gw 192.168.0.1 是网关，dev eth0就是设备
</span><span class='line'>$ route add -net 192.168.0.0/24 gw 192.168.0.1 dev eth0
</span><span class='line'>
</span><span class='line'># 例2: eth0默认网段的数据，都交给192.168.0.1网关
</span><span class='line'>$ route add default gw 192.168.0.1 dev eth0
</span><span class='line'>
</span><span class='line'># 例3: eth0发往192.168.0.105主机的数据，都交给192.168.0.1网关
</span><span class='line'>$ route add -host 192.168.0.105 gw 192.168.0.1 dev eth0
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[tcpdump 简明教程]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/03/tcpdump-jian-ming-jiao-cheng/"/>
    <updated>2013-04-03T16:10:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/03/tcpdump-jian-ming-jiao-cheng</id>
    <content type="html"><![CDATA[<ul>
<li>tcpdump作用很简单，就是抓取数据包。很常用的网络分析工具。对于理解tcp/ip协议也非常有帮助。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 请使用root用户，运行下面的命令捕获数据，你会发现数据包多的自己都不想看了
</span><span class='line'>$ sudo tcpdump</span></code></pre></td></tr></table></div></figure>




<!-- more -->


<ul>
<li>tcpdump有很多选项，不过先不急着学选项。先能用起来才是关键，那先看几个<code>条件关键字</code>吧</li>
</ul>


<table class="table table-bordered" style="max-width:350px; margin-left:37px">
<tbody>
  <tr>
    <td>host</td>
    <td>可以是ip也可以是主机名</td>
  </tr>
  <tr>
    <td>net</td>
    <td>网段</td>
  </tr>
  <tr>
    <td>port</td>
    <td>端口</td>
  </tr>
  <tr>
    <td>ip,tcp,icmp,udp</td>
    <td>协议</td>
  </tr>
  <tr>
    <td>src</td>
    <td>来源</td>
  </tr>
  <tr>
    <td>dst</td>
    <td>目的地</td>
  </tr>
  <tr>
    <td>and</td>
    <td>同时满足</td>
  </tr>
  <tr>
    <td>or</td>
    <td>满足任何一个即可</td>
  </tr>
  <tr>
    <td>not</td>
    <td>非</td>
  </tr>
</tbody>
</table>


<ul>
<li>学了那么多条件关键字，来几个例子用起来吧</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 先学习几个简单的
</span><span class='line'>$ sudo tcpdump host 192.168.0.145
</span><span class='line'>$ sudo tcpdump src 192.168.0.145
</span><span class='line'>$ sudo tcpdump dst 192.168.0.145
</span><span class='line'>$ sudo tcpdump net 192.168.0.0/24
</span><span class='line'>$ sudo tcpdump tcp
</span><span class='line'>$ tcpdump port 80
</span><span class='line'>
</span><span class='line'># 组合起来用用
</span><span class='line'>$ sudo tcpdump tcp and src host 192.168.0.145 and port 80
</span><span class='line'>$ sudo tcpdump ip and not dst 192.168.0.145 and dst port 80
</span><span class='line'>
</span><span class='line'># 加上组，可以更加复杂一些
</span><span class='line'>$ sudo tcpdump tcp and host 192.168.0.145 and \(port 80 or port 8080\)
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>感觉不错，加一点选项让tcpdump更加有用</li>
</ul>


<table class="table table-bordered" style="max-width:350px; margin-left:37px">
<tbody>
  <tr>
    <td>-w file-name</td>
    <td>将捕获到的数据写入文件</td>
  </tr>
  <tr>
    <td>-i device-name</td>
    <td>网络设备名，常用eth0</td>
  </tr>
  <tr>
    <td>-n</td>
    <td>不解析域名</td>
  </tr>
  <tr>
    <td>-nn</td>
    <td>不解析域名和端口</td>
  </tr>
  <tr>
    <td>-X,-XX</td>
    <td>用16进制和ascii显示包里的内容</td>
  </tr>
  <tr>
    <td>-v,-vv,-vvv</td>
    <td>越多越详细的头</td>
  </tr>
  <tr>
    <td>-c number</td>
    <td>捕获包的数量</td>
  </tr>
  <tr>
    <td>-s number</td>
    <td>获取多少内容, 0代表所有</td>
  </tr>
  <tr>
    <td>-S</td>
    <td>打印绝对的序列号</td>
  </tr>
</tbody>
</table>


<ul>
<li>让选项和条件组合起来，发挥tcpdump强大威力</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo tcpdump -vXSs 0 not dst port 8080 and \(dst net 10.0.0.0/8 or 192.168.0.0/24\)
</span><span class='line'>
</span><span class='line'># 一个http的数据包
</span><span class='line'>17:55:51.846893 IP (tos 0x0, ttl 43, id 10976, offset 0, flags [DF], proto TCP (6), length 237)
</span><span class='line'>    ec2-23-21-128-184.compute-1.amazonaws.com.http &gt; 192.168.0.145.60897: Flags [P.], cksum 0x5e78 (correct), seq 504653705:504653890, ack 894919854, win 27, options [nop,nop,TS val 222645590 ecr 909764515], length 185
</span><span class='line'>    0x0000:  4500 00ed 2ae0 4000 2b06 cb24 1715 80b8  E...*.@.+..$....
</span><span class='line'>    0x0010:  c0a8 0091 0050 ede1 1e14 6789 3557 64ae  .....P....g.5Wd.
</span><span class='line'>    0x0020:  8018 001b 5e78 0000 0101 080a 0d45 4d56  ....^x.......EMV
</span><span class='line'>    0x0030:  3639 e7a3 4854 5450 2f31 2e31 2032 3030  69..HTTP/1.1.200
</span><span class='line'>    0x0040:  204f 4b0d 0a53 6572 7665 723a 206e 6769  .OK..Server:.ngi
</span><span class='line'>    0x0050:  6e78 2f30 2e37 2e36 370d 0a44 6174 653a  nx/0.7.67..Date:
</span><span class='line'>    0x0060:  2057 6564 2c20 3033 2041 7072 2032 3031  .Wed,.03.Apr.201
</span><span class='line'>    0x0070:  3320 3039 3a35 353a 3531 2047 4d54 0d0a  3.09:55:51.GMT..
</span><span class='line'>    0x0080:  436f 6e74 656e 742d 5479 7065 3a20 696d  Content-Type:.im
</span><span class='line'>    0x0090:  6167 652f 6769 660d 0a43 6f6e 7465 6e74  age/gif..Content
</span><span class='line'>    0x00a0:  2d4c 656e 6774 683a 2034 330d 0a43 6f6e  -Length:.43..Con
</span><span class='line'>    0x00b0:  6e65 6374 696f 6e3a 2063 6c6f 7365 0d0a  nection:.close..
</span><span class='line'>    0x00c0:  0d0a 4749 4638 3961 0100 0100 8001 0000  ..GIF89a........
</span><span class='line'>    0x00d0:  0000 ffff ff21 f904 0100 0001 002c 0000  .....!.......,..
</span><span class='line'>    0x00e0:  0000 0100 0100 0002 024c 0100 3b         .........L..;
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>tcpdump还可以根据tcp里某些状态位进行过滤</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tcpdump 'tcp[13] & 1!=0'</span></code></pre></td></tr></table></div></figure>




<br />


<ul>
<li>附送tcp头信息图
<img src="http://www.wanghd.com/images/post/tcp-header.jpg" title="tcp-header" alt="tcp-header" /></li>
</ul>


<br />


<ul>
<li>附送ip头信息图
<img src="http://www.wanghd.com/images/post/ip-header.jpg" title="ip-header" alt="ip-header" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ibm x3650 重装系统]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/03/ibm-x3650-zhong-zhuang-xi-tong/"/>
    <updated>2013-04-03T16:02:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/03/ibm-x3650-zhong-zhuang-xi-tong</id>
    <content type="html"><![CDATA[<h3>从机房把5年前的x3650拖回来重装系统全过程</h3>

<ul>
<li><p>原本是freebsd，做了raid1。现在希望改成ubuntu，不做raid，因为提供mogilefs服务</p></li>
<li><p>开机启动根据提示Ctrl + A进入raid管理</p></li>
<li>删除raid退出</li>
<li>开始安装ubuntu。。。发现找不到硬盘</li>
<li>难道没有raid就不行？再进到raid管理</li>
<li>进行硬盘初始化，然后创建raid使用简单卷Volume即可</li>
<li>一路安装终于没有问题了</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu服务器增加磁盘]]></title>
    <link href="http://www.wanghd.com/blog/2013/04/03/fu-wu-qi-zeng-jia-ci-pan/"/>
    <updated>2013-04-03T11:57:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/04/03/fu-wu-qi-zeng-jia-ci-pan</id>
    <content type="html"><![CDATA[<h3>显示硬盘分区</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo fdisk -lu
</span><span class='line'>
</span><span class='line'># 系统显示最下面显示：disk /dev/sdb doesn't contain a valid partition table</span></code></pre></td></tr></table></div></figure>


<h3>对sdb进行分区</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo fdisk /dev/sdb</span></code></pre></td></tr></table></div></figure>


<ol>
<li>按m显示帮助文档</li>
<li>根据提示按n 添加一个新分区</li>
<li>按e 添加扩展分区，接下去默认即可</li>
<li>回到帮助文档，按p 显示分区结果</li>
<li>按w 保存分区，并退出完成</li>
<li>可以再fdisk -lu看看，结果已经不同了，硬盘认出来了</li>
</ol>


<!-- more -->


<h3>格式化磁盘</h3>

<ul>
<li>-t 是文件系统类型</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mkfs -t ext4 /dev/sdb</span></code></pre></td></tr></table></div></figure>


<h3>挂载磁盘</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mount -t ext4  /data
</span><span class='line'>
</span><span class='line'># 查看结果，应该有记录了
</span><span class='line'>sudo df -l</span></code></pre></td></tr></table></div></figure>


<h3>配置启动挂载</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo blkid /dev/sdb
</span><span class='line'># 显示 /dev/sdb: UUID="cc6f31aa-9af3-4283-8e52-8d31f5ebbd36" TYPE="ext4"
</span><span class='line'>
</span><span class='line'>vim /etc/fstab
</span><span class='line'># 添加一行
</span><span class='line'>UUID=cc6f31aa-9af3-4283-8e52-8d31f5ebbd36 /data ext4 defaults 0 0</span></code></pre></td></tr></table></div></figure>


<ul>
<li>fstab里的pass 根目录应当获得最高的优先权 1, 其它所有需要被检查的设备设置为 2. 0 表示设备不会被 fsck 所检查。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[nginx 配置模板]]></title>
    <link href="http://www.wanghd.com/blog/2013/03/31/nginx-pei-zhi-mo-ban/"/>
    <updated>2013-03-31T16:02:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/03/31/nginx-pei-zhi-mo-ban</id>
    <content type="html"><![CDATA[<h3>nginx服务器端配置，可以适当调整:</h3>

<ul>
<li>调整fastcgi 和 lb 的配置</li>
<li>上传文件大小</li>
</ul>


<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user  william wheel;
</span><span class='line'># 与内核数量相等即可
</span><span class='line'>worker_processes  4;
</span><span class='line'>
</span><span class='line'>error_log  /usr/local/log/nginx/error.log  notice;
</span><span class='line'>pid        /usr/local/log/nginx/nginx.pid;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>events {
</span><span class='line'>    worker_connections  10240;
</span><span class='line'>    use epoll;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>http {
</span><span class='line'>
</span><span class='line'>    server_names_hash_bucket_size 64;
</span><span class='line'>
</span><span class='line'>    include       mime.types;
</span><span class='line'>    default_type  application/octet-stream;
</span><span class='line'>
</span><span class='line'>    log_format  main '$request_time $upstream_response_time $remote_addr $request_length $upstream_addr  [$time_local] '
</span><span class='line'>                      '$host "$request" $status $bytes_sent '
</span><span class='line'>                      '"$http_referer" "$http_user_agent" "$gzip_ratio" "$http_x_forwarded_for" - "$server_addr"';
</span><span class='line'>
</span><span class='line'>    access_log  /usr/local/log/nginx/access.log  main;
</span><span class='line'>
</span><span class='line'>    # 单单作为lb可以关闭sendfile
</span><span class='line'>    sendfile        on;
</span><span class='line'>    tcp_nopush      on;
</span><span class='line'>
</span><span class='line'>    # 单单作为lb应该调低，例如5或10，避免空闲连接过多
</span><span class='line'>    keepalive_timeout  20;
</span><span class='line'>
</span><span class='line'>    # 单单作为lb不要开启gzip
</span><span class='line'>    gzip  on;
</span><span class='line'>
</span><span class='line'>    # 限制内容大小，如果上传文件比较大，可以调整
</span><span class='line'>    client_max_body_size  2m;
</span><span class='line'>    client_body_buffer_size 1m;
</span><span class='line'>
</span><span class='line'>    charset utf-8;
</span><span class='line'>
</span><span class='line'>    # 反向代理
</span><span class='line'>    proxy_buffering  on;
</span><span class='line'>    proxy_buffers 400 256k;
</span><span class='line'>    proxy_set_header Host $host;
</span><span class='line'>    proxy_set_header X-Real-IP $remote_addr;
</span><span class='line'>    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span><span class='line'>
</span><span class='line'>    # fastcgi
</span><span class='line'>    fastcgi_connect_timeout 30;
</span><span class='line'>    fastcgi_send_timeout 30;
</span><span class='line'>    fastcgi_read_timeout 30;
</span><span class='line'>    fastcgi_buffers 200 256k;
</span><span class='line'>
</span><span class='line'>    include /usr/local/etc/nginx/conf.d/*.conf;
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntu 修复locale错误]]></title>
    <link href="http://www.wanghd.com/blog/2013/03/27/ubuntu-xiu-fu-localecuo-wu/"/>
    <updated>2013-03-27T10:55:00+08:00</updated>
    <id>http://www.wanghd.com/blog/2013/03/27/ubuntu-xiu-fu-localecuo-wu</id>
    <content type="html"><![CDATA[<ul>
<li>locale 配置错误：Cannot set LC_ALL to default locale: No such file or directory</li>
</ul>


<!-- more -->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@server:~# locale
</span><span class='line'>locale: Cannot set LC_ALL to default locale: No such file or directory
</span><span class='line'>LANG=en_US.UTF-8
</span><span class='line'>LANGUAGE=en_US:en
</span><span class='line'>LC_CTYPE="en_US.UTF-8"
</span><span class='line'>LC_NUMERIC=en_US
</span><span class='line'>LC_TIME=en_US
</span><span class='line'>LC_COLLATE="en_US.UTF-8"
</span><span class='line'>LC_MONETARY=en_US
</span><span class='line'>LC_MESSAGES="en_US.UTF-8"
</span><span class='line'>LC_PAPER=en_US
</span><span class='line'>LC_NAME=en_US
</span><span class='line'>LC_ADDRESS=en_US
</span><span class='line'>LC_TELEPHONE=en_US
</span><span class='line'>LC_MEASUREMENT=en_US
</span><span class='line'>LC_IDENTIFICATION=en_US
</span><span class='line'>LC_ALL=</span></code></pre></td></tr></table></div></figure>


<ul>
<li>修复：重新生成配置</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo locale-gen en_US en_US.UTF-8
</span><span class='line'>dpkg-reconfigure locales </span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
